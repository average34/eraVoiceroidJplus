;Ver2.02
;-------------------------------------------------
;口上用の関数
;-------------------------------------------------
 ;@GET_VERSION_YUCTION バージョン取得関数
 ;@EVENTLOAD イベント関数なのでここで問題ないはず、セーブデータ互換処理を呼び出す
 ;@SET_COMFLAG(ARG)　コマンド初回実行時のCFLAG保存用関数
 ;@GET_COMFLAG(ARG, ARG:1)　コマンド用CFLAGチェック用式中関数
 ;@SET_EVENTFLAG(ARG, ARG:1, ARG:2)　式中以外でイベントフラグを立てるための関数
 ;@GET_EVENTFLAGイベント用式中関数
 ;@GET_EXISTANCE(ARG)　存在判定関数を式中関数に移植
 ;@GET_EX　絶頂内容取得関数
 ;@INPUT_YN　二択提示用関数
 ;@INPUT_MANY　数量入力用関数
;-------------------------------------------------
;----------------------------------------------------------------
;バージョン取得関数 @GET_VERSION_YUCTION 
;					@GET_VERSION_YUSYS
;呼ぶとバージョンが帰ってくる
;使い道はもちろん警告用
;-は関数名つけるうえじゃまずいようなのでついてないので注意
;----------------------------------------------------------------
@GET_VERSION_YUCTION(ARG)
#FUNCTION
RETURNF 202

@EVENTLOAD
;口上のデータ互換処理を呼びだす。ここで呼ぶのがまぁスマートでしょう
;TARGETを一時的に変更する措置
LOCAL:1 = TARGET
FOR LOCAL, 0, CHARANUM
	TARGET = CHARANUM -1
	TRYCALLFORM KOJO_ISIMTERCHANGEABILITY_{NO:LOCAL}
NEXT
TARGET = LOCAL:1
@SET_COMFLAG(ARG, ARG:1, ARG:2)
;----------------------------------------------------------------
;コマンドの初回実行時のCFLAGを保存用関数
;CFLAG:201~220を使用
;引数0は使用ナンバー（直接指定しない場合はSELECTCOMをいれる）
;引数1は真の時、フラグを折る
;引数2はキャラ登録番号、省略した場合はTARGET
;1000以降はSELECTCOM指定で漏れる個別指定用の枠とする
;----------------------------------------------------------------
ARG:2 = ARG:2 ? ARG:2 # TARGET
;0未満が来た場合と1261以上が来た場合ははじいとく
IF ARG >= 1260 || ARG < 0 || ARG:2 < 0
	PRINTW 引数が不正です。修正してください。
	RETURN 0
ENDIF
;通常処理
;使うCFLAGの決定
LOCAL = ARG / 63 + 201
;そのCFLAGの何番目のBITか
LOCAL:1 = ARG % 63
;フラグセット
IF ARG:1
	CLEARBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
ELSE
	SETBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
ENDIF

;-------------------------------------------------
;コマンド用　CFLAGチェック用式中関数
;引数0に調べたいコマンド番号を入力、省略した場合は現在のコマンドをチェック
;引数1が1の時、フラグを立てる、－1のときフラグを寝かせる
;引数2はキャラ登録番号、省略した場合はTARGET
;フラグが立っている場合、1が帰ってくる
;愛撫の場合は引数に-1を指定
;デートは1000+TEQUIP:2、プレゼントは1180＋TFLAG:17で個別指定
;-------------------------------------------------
@GET_COMFLAG(ARG, ARG:1, ARG:2)
#FUNCTION
ARG:2 = ARG:2 ? ARG:2 # TARGET
SIF ARG >= 1260 || ARG < 0 || ARG:2 < 0
	STR:0 = "引数の数値が異常です"
LOCAL = ARG / 63 + 201
LOCAL:1 = ARG % 63
IF GETBIT(CFLAG:(ARG:2):LOCAL, LOCAL:1)
	IF ARG:1 == 1
		SETBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ELSEIF ARG:1 == -1
		CLEARBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ENDIF
	RETURNF 1
ELSE
	IF ARG:1 == 1
		SETBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ELSEIF ARG:1 == -1
		CLEARBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ENDIF
	RETURNF 0
ENDIF

@SET_EVENTFLAG(ARG, ARG:1, ARG:2)
;-------------------------------------------------
;式中以外でイベントフラグを立てるための関数
;引数0はイベント番号
;引数1は真だとフラグを寝かす
;引数2はキャラ登録番号（省略するとTARGET）
;221~240を使用　イベント番号は1260まで
;-------------------------------------------------
ARG:2 = ARG:2 ? ARG:2 # TARGET
;1259を超えるか負か対象キャラがいないなら0を返す
IF ARG >= 1260 || ARG < 0 || ARG:2 < 0
	PRINTW 引数が不正です。修正してください。
	RETURN 0
ENDIF
LOCAL = 221 + ARG/63
LOCAL:1 = ARG % 63
IF ARG:1
	CLEARBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
ELSE
	SETBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
ENDIF
RETURN 0
;-------------------------------------------------
;イベント用関数
;Rev用のFUNCTION.ERBの未読判定関数@FIRSTTIMEを移植＆改造
;式中で使用する関数です。CFLAG:221～240を利用します
;イベント番号0～1259まで管理可能
;引数0はイベント番号
;引数1は1だとフラグを起こす。-1だとフラグを寝かす
;引数2はキャラ登録番号（省略するとTARGET）
;フラグがたってたら1を、たってなかったら0を返す
;-------------------------------------------------
@GET_EVENTFLAG(ARG, ARG:1, ARG:2)
#FUNCTION
ARG:2 = ARG:2 ? ARG:2 # TARGET
;1259を超えるか負か対象キャラがいないなら0を返す
SIF ARG >= 1260 || ARG < 0 || ARG:2 < 0
	STR:0 = "引数の数値が異常です"

LOCAL = 221 + ARG/63
LOCAL:1 = ARG % 63
IF !GETBIT(CFLAG:(ARG:2):LOCAL, LOCAL:1)
	IF ARG:1 == 1
		SETBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ELSEIF ARG:1 == -1
		CLEARBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ENDIF
	RETURNF 0
ELSE
	IF ARG:1 == 1
		SETBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ELSEIF ARG:1 == -1
		CLEARBIT CFLAG:(ARG:2):LOCAL, LOCAL:1
	ENDIF
	RETURNF 1
ENDIF

;-------------------------------------------------
;存在判定関数を式中関数に移植
;引数0にキャラナンバーを入れて、そのキャラがいる場合はキャラ登録番号、いない場合は0を返す
;引数1が真の場合は、不在フラグがたってる場合でもキャラが生成されてればキャラ登録番号を返す
;-------------------------------------------------
@GET_EXISTANCE3(ARG, ARG:1)
#FUNCTION
GETCHARA ARG
SIF RESULT < 0
	RETURNF 0
SIF CFLAG:RESULT:21 == 1 && ARG:1 == 0
	RETURNF 0
RETURNF RESULT

;-------------------------------------------------
;絶頂内容取得関数@GET_EX
;ARGSにはCVABもしくは2重・3重・4重を入れて使う
;CVABの場合は対応したNOWEXが多重ボーナスかかる前の状態で帰ってくる
;多重の場合は真かどうかを見る
;いちいち半角全角漢数字アラビア数字を確認するのが嫌なので、そこらへん全部通るようにしておく
;-------------------------------------------------
@GET_EX(ARGS)
#FUNCTION
LOCAL = NOWEX:0
LOCAL:1 = NOWEX:1
LOCAL:2 = NOWEX:2
LOCAL:3 = NOWEX:3
;4重絶頂
IF LOCAL:0 > 0 && LOCAL:1 > 0 && LOCAL:2 > 0 && LOCAL:3 > 0
	LOCAL:0 /= 8
	LOCAL:1 /= 8
	LOCAL:2 /= 8
	LOCAL:3 /= 8
	SIF ARGS == "4重" || ARGS == "４重" || ARGS == "四重"
		RETURNF 1
;3重絶頂
ELSEIF (LOCAL:0 > 0 && LOCAL:1 > 0 && LOCAL:2 > 0) || (LOCAL:0 > 0 && LOCAL:1 > 0 && LOCAL:3 > 0) || (LOCAL:0 > 0 && LOCAL:2 > 0 && LOCAL:3 > 0) || (LOCAL:1 > 0 && LOCAL:2 > 0 && LOCAL:3 > 0)
	LOCAL:0 /= 4
	LOCAL:1 /= 4
	LOCAL:2 /= 4
	LOCAL:3 /= 4
	SIF ARGS == "3重" || ARGS == "３重" || ARGS == "三重"
		RETURNF 1
;2重絶頂
ELSEIF (LOCAL:0 > 0 && LOCAL:1 > 0) || (LOCAL:0 > 0 && LOCAL:2 > 0) || (LOCAL:0 > 0 && LOCAL:3 > 0) || (LOCAL:0 > 1 && LOCAL:2 > 0) || (LOCAL:0 > 1 && LOCAL:3 > 0) || (LOCAL:0 > 2 && LOCAL:3 > 0)
	LOCAL:0 /= 2
	LOCAL:1 /= 2
	LOCAL:2 /= 2
	LOCAL:3 /= 2
	SIF ARGS == "2重" || ARGS == "２重" || ARGS == "ニ重"
		RETURNF 1
ENDIF
IF ARGS == "C" || ARGS == "Ｃ"
	RETURNF LOCAL
ELSEIF ARGS == "V" || ARGS == "Ｖ"
	RETURNF LOCAL:1
ELSEIF ARGS == "A" || ARGS == "Ａ"
	RETURNF LOCAL:2
ELSEIF ARGS == "B" || ARGS == "Ｂ"
	RETURNF LOCAL:3
ENDIF
RETURNF 0

;-------------------------------------------------
;2択提示関数　@INPUT_YN
;いちいち、INPUT_LOOP書くのめんどいよ！
;っていうか、2択提示はめちゃめちゃ多いんだから、関数化しちゃえばいいじゃないかときづく
;INPUTINTでもまぁほとんど同じだけど、これほんとよく使う定形だから、別関数として独立させる
;-------------------------------------------------
@INPUT_YN, ARGS = "はい", ARGS:1 = "いいえ"
PRINTFORML [0] %ARGS%
PRINTFORML [1] %ARGS:1%
$INPUT_LOOP
INPUT
IF RESULT == 0
	RETURN 0
ELSEIF RESULT == 1
	RETURN 1
ELSE
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF

;-------------------------------------------------
;数量入力用関数　@INPUT_MANY
;ARGで最小値、ARG:1で最大値を指定
;ARG:2~11は指定枠、最小値、最大値から漏れてる数字でもこの中にいれた数値は有効となる
;なお、いかなる場合でも0は指定可能にしてあるので注意（主にキャンセル用ともいう）
;というより、基本的に最低値が0になる場合においてつかわれることを想定しています（のわりに負の数にも対応してるけど）
;ボタンが恐ろしい数になってるのは、直接入力と共存させるため。ちょっと見た目は美しくない
;INPUTとINPUTSが共存できれば、こんなことにはならないんだけどまぁ仕方ない
;
;eraMegatenで作ったものを移植。口上で使う可能性は恐ろしく低いどころか
;Jで使うかどうかもあやしいですが、一応
;-------------------------------------------------
@INPUT_MANY(ARG = 0 , ARG:1 = 99 , ARG:2, ARG:3, ARG:4, ARG:5, ARG:6, ARG:7, ARG:8, ARG:9, ARG:10, ARG:11)
;最大が省略されてたら99にする,最大値が0個になる場合もあるので諦める。まぁちゃんと指定しろってことですね
VARSET LOCAL
;最初は一桁目
LOCAL = 1
$START
LOCAL:100 = LOCAL:102 ? -(ABS(LOCAL:100)) # ABS(LOCAL:100)
PRINTFORML 【{LOCAL:100}】　《【{ARG}】 - 【{ARG:1}】》
PRINTBUTTON "[7]",1000000000000000007
PRINT 　
PRINTBUTTON "[8]",1000000000000000008
PRINT 　
PRINTBUTTON "[9]",1000000000000000009
PRINT 　
PRINTBUTTON "[ AC]",1000000000000000010
PRINTL 

PRINTBUTTON "[4]",1000000000000000004
PRINT 　
PRINTBUTTON "[5]",1000000000000000005
PRINT 　
PRINTBUTTON "[6]",1000000000000000006
PRINT 　
PRINTBUTTON "[Max]",1000000000000000011
PRINTL 

PRINTBUTTON "[1]",1000000000000000001
PRINT 　
PRINTBUTTON "[2]",1000000000000000002
PRINT 　
PRINTBUTTON "[3]",1000000000000000003
PRINT 　
PRINTBUTTON "[Min]",1000000000000000012
PRINTL 

PRINTBUTTON "[0]",1000000000000000000
PRINT 　
IF LOCAL:102
	PRINTBUTTON "[+]",1000000000000000014
ELSE
	PRINTBUTTON "[-]",1000000000000000014
ENDIF
PRINT 　
PRINTBUTTON "[ENTER]",1000000000000000013
PRINTL 
PRINTFORML ※キーボードから、直接数値を入力することもできます
INPUT
CLEARLINE 7
IF RESULT == 1000000000000000014
	LOCAL:102 = LOCAL:102 ? 0 # 1
ELSEIF RESULT == 1000000000000000010
	RESTART
ELSEIF RESULT == 1000000000000000011
	LOCAL:100 = ARG:1
	LOCAL:102 = ARG:1 >= 0 ? 0 # 1
ELSEIF RESULT == 1000000000000000012
	LOCAL:100 = ARG
	LOCAL:102 = ARG >= 0 ? 0 # 1
ELSEIF RESULT == 1000000000000000013
	GOTO END
ENDIF
;先頭の桁に0をいれることはできない
SIF (LOCAL == 1 && RESULT == 1000000000000000000) || RESULT > 1000000000000000009
	GOTO START
IF RESULT < 100000000000000000
	LOCAL:100 = RESULT
	GOTO END
ENDIF
IF LOCAL > 19
	PRINTFORMW 桁数が多すぎます！
	RESTART
ENDIF
;LOCAL 桁数
;LOCAL:N 桁内の数値の保存場所
;LOCAL:100 数値
;LOCAL:101 桁数退避場所
;LOCAL:102 マイナスフラグ
LOCAL:LOCAL = RESULT - 1000000000000000000
LOCAL:101 = LOCAL
LOCAL:100 = 0
COUNT = 1
WHILE LOCAL
	LOCAL:100 += LOCAL:COUNT * POWER(10, LOCAL-1)
	LOCAL -= 1
	COUNT += 1
WEND
;マイナスフラグONでマイナスに
SIF LOCAL:102
	LOCAL:100 *= -1
;桁数復帰させつつ、増やす
LOCAL = LOCAL:101 + 1
GOTO START
$END
;0は常に入力可能で0を返す
SIF LOCAL:100 == 0
	RETURN 0
;特別枠にあたった場合も返す
FOR COUNT, 2, 12
	SIF LOCAL:100 == ARG:COUNT
		RETURN ARG:COUNT
NEXT
;そして、値が範囲内ならその数値を返す
SIF LOCAL:100 >= ARG && LOCAL:100 <= ARG:1
	RETURN LOCAL:100
PRINTFORMW 数値が範囲外です。入力しなおしてください
RESTART

;-------------------------------------------------
;@STRFLAG_D ダンジョンフラグ文字列管理関数
;ダンジョンフラグを文字列で管理する関数です
;ARGSはイベントフラグ名
;ARGはキャラ番号
;ARGS:1は1の場合はフラグを立てる、-1の場合はフラグを消す
;CSTR:0を使用
;半角で2000字オーバーでエラー落ちする仕様。100～200フラグぐらいははいりますが…足りなかったら
;適当に数値のほうにもまわすか、フラグ名を工夫するかですかねぇ
;-------------------------------------------------
@STRFLAG_C(ARGS, ARG = -1, ARG:1)
#FUNCTION
SIF ARG == -1 
	ARG = TARGET
SIF ARG < 0 || ARG >= CHARANUM
	STR:99 = "ARGの数値が異常です"
;使用するSAVESTRの配列にあわせる
SIF CSTR:0 == ""
	CSTR:0 = /
LOCALS = /%ARGS%/
IF STRCOUNT(CSTR:0, LOCALS)
	SIF ARG:1 == -1
		CSTR:0 = %DEL_STRFLAG(CSTR:0, ARGS)%
	RETURNF 1
ELSE
	SIF ARG:1 == 1
		CSTR:0 = %CSTR:0%%ARGS%/
	SIF STRLENS(CSTR:0) > 2000
		STR:99 = "文字列の中身が多くなりすぎて記録しきれません！"
	RETURNF 0
ENDIF

;-------------------------------------------------
;@DEL_STRFLAG
;ARGSからARGS:1を除去したものを返す関数
;ARGS:1が含まれてなければ当然、ARGSがそのまま帰ってくる
;/ARGS:1/をけして、/を残すので思いっきりSTRFLAG用
;-------------------------------------------------
@DEL_STRFLAG(ARGS, ARGS:1)
#FUNCTIONS
ARGS:1 = /%ARGS:1%/
SIF STRFIND(ARGS, ARGS:1, 0) == -1
	RETURNF ARGS
LOCALS = %SUBSTRING(ARGS,0,STRFIND(ARGS, ARGS:1,0))%
LOCALS:1 = %SUBSTRING(ARGS,STRFIND(ARGS, ARGS:1)+STRLENS(ARGS:1),-1)%
LOCALS = %LOCALS%/%LOCALS:1%
RETURNF LOCALS
;-------------------------------------------------
;NOWEX調整関数
;NOWEXの同時絶頂による回数補正を消して、純粋な絶頂回数に調整する
;例えば、クンニで絶頂と強絶頂を条件として分岐させる際、通常だと強絶頂とバイブをつかってのVCの同時絶頂は共にNOWEX:0 == 2であり
;区別することができないが、この関数を利用することで、後者のNOWEXを1にできるので、二つを簡単に区別できるようになる
;-------------------------------------------------
@ADJUST_NOWEX
;4重絶頂
IF NOWEX:0 > 0 && NOWEX:1 > 0 && NOWEX:2 > 0 && NOWEX:3 > 0
	NOWEX:0 /= 8
	NOWEX:1 /= 8
	NOWEX:2 /= 8
	NOWEX:3 /= 8
;3重絶頂
ELSEIF (NOWEX:0 > 0 && NOWEX:1 > 0 && NOWEX:2 > 0) || (NOWEX:0 > 0 && NOWEX:1 > 0 && NOWEX:3 > 0) || (NOWEX:0 > 0 && NOWEX:2 > 0 && NOWEX:3 > 0) || (NOWEX:1 > 0 && NOWEX:2 > 0 && NOWEX:3 > 0)
	NOWEX:0 /= 4
	NOWEX:1 /= 4
	NOWEX:2 /= 4
	NOWEX:3 /= 4
;2重絶頂
ELSEIF (NOWEX:0 > 0 && NOWEX:1 > 0) || (NOWEX:0 > 0 && NOWEX:2 > 0) || (NOWEX:0 > 0 && NOWEX:3 > 0) || (NOWEX:0 > 1 && NOWEX:2 > 0) || (NOWEX:0 > 1 && NOWEX:3 > 0) || (NOWEX:0 > 2 && NOWEX:3 > 0)
	NOWEX:0 /= 2
	NOWEX:1 /= 2
	NOWEX:2 /= 2
	NOWEX:3 /= 2
ENDIF
;----------------------------------------------------------------
;地の文カット関数
;FLAG:6を利用して一時的に地の分をカットする
;----------------------------------------------------------------
@KOJO_CUT
;地の文カット用のフラグ立て
IF FLAG:6 == 1
	CFLAG:651 = 1
	FLAG:6 = 0
ENDIF

@KOJO_CUT_RETURN
;地の文カット用のフラグ復帰
IF CFLAG:651 == 1 && FLAG:6 == 0
	FLAG:6 = 1
ENDIF
CFLAG:651 = 0

;----------------------------------------------------------------
;喧嘩用の強制終了用関数
;CFLAG653を使用
;@CONFLICTを口上内で呼び出した場合、強制的に調教が終了します
;さらに調教後セックスなどのイベントと朝フェラなどの朝イベントが発生しなくなります
;そして、@KOJO_JUNのTFLAG:600 == 38においてCALL RETURN_CONFLICTを宣言することで
;その際変更した素質・フラグを元に戻すことができます
;なおCONFLICTは調教中、CONFLICT2は休憩や戦闘訓練といった調教をせずに時間経過させるものに使うようになっています
;----------------------------------------------------------------
@CONFLICT
SELECTCOM = -1
;夜の場合　朝イベント回避のために色々変更
IF TIME
	CFLAG:653 = 1
	;朝フェラの条件回避のために一晩の間女に
	IF TALENT:MASTER:119
		TALENT:MASTER:119 = 0
		CFLAG:653 |= 2
	ENDIF
	IF TALENT:MASTER:121
		TALENT:MASTER:121 = 0
		CFLAG:653 |= 4
	ENDIF
	IF TALENT:MASTER:122
		TALENT:MASTER:122 = 0
		CFLAG:653 |= 8
	ENDIF
	;拡張朝イベントの条件回避に淫乱と恋慕と相愛を一時的に0に
	IF TALENT:76
		TALENT:76 = 0
		CFLAG:653 |= 16
	ENDIF
	IF TALENT:85
		TALENT:85 = 0
		CFLAG:653 |= 32
	ENDIF
	IF TALENT:89
		TALENT:89 = 0
		CFLAG:653 |= 64
	ENDIF
	;恋慕の再獲得を防止のために好感度がすごいことに
	CFLAG:2 *= -1
ENDIF
;@RETURN_TALENTが存在しない可能性もあるので生で記述
;一時的な素質変化の復帰
;胸の復帰
IF TEQUIP:40 & 7
	TALENT:109 = 0
	TALENT:110 = 0
	IF TEQUIP:40 & 1
		TALENT:109 = 1
	ELSEIF TEQUIP:40 & 4
		TALENT:110 = 1
	ENDIF
ENDIF
;体型を正常に
IF TEQUIP:40 & 8
	TALENT:100 = 0
ENDIF
IF TEQUIP:40 & 16
	TALENT:100 = 1
ENDIF
;獣耳喪失
IF TEQUIP:40 & 32
	TALENT:124 = 0
ENDIF
;超敏感体質喪失
IF TEQUIP:40 & 64
	;有利素質は手抜き
	TALENT:42 -= 1
	TALENT:102 -= 1
	TALENT:104 -= 1
	TALENT:106 -= 1
	TALENT:108 -= 1
	IF (TEQUIP:40 & 128) > 0
		TALENT:43 = 1
	ENDIF
	IF (TEQUIP:40 & 256) > 0
		TALENT:101 = 1
	ENDIF
	IF (TEQUIP:40 & 512) > 0
		TALENT:103 = 1
	ENDIF
	IF (TEQUIP:40 & 1024) > 0
		TALENT:105 = 1
	ENDIF
	IF (TEQUIP:40 & 2048) > 0
		TALENT:107 = 1
	ENDIF
ENDIF

;強制終了
BEGIN TURNEND

@CONFLICT2
SELECTCOM = -1
;夜の場合　朝イベント回避のために色々変更
IF TIME
	CFLAG:653 = 1
	;朝フェラの条件回避のために一晩の間女に
	IF TALENT:MASTER:119
		TALENT:MASTER:119 = 0
		CFLAG:653 |= 2
	ENDIF
	IF TALENT:MASTER:121
		TALENT:MASTER:121 = 0
		CFLAG:653 |= 4
	ENDIF
	IF TALENT:MASTER:122
		TALENT:MASTER:122 = 0
		CFLAG:653 |= 8
	ENDIF
	;拡張朝イベントの条件回避に淫乱と恋慕と相愛を一時的に0に
	IF TALENT:76
		TALENT:76 = 0
		CFLAG:653 |= 16
	ENDIF
	IF TALENT:85
		TALENT:85 = 0
		CFLAG:653 |= 32
	ENDIF
	IF TALENT:89
		TALENT:89 = 0
		CFLAG:653 |= 64
	ENDIF
	;恋慕の再獲得を防止のために好感度がすごいことに
	CFLAG:2 *= -1
ENDIF

@RETURN_CONFLICT
SIF CFLAG:653 == 0
	RETURN 0
;朝フェラの条件回避復帰
IF (CFLAG:653 & 2) > 0
	TALENT:MASTER:119 = 1
ENDIF
IF (CFLAG:653 & 4) > 0
	TALENT:MASTER:121 = 1
ENDIF
IF (CFLAG:653 & 8) > 0
	TALENT:MASTER:122 = 1
ENDIF
;拡張朝イベントの条件回避に淫乱と恋慕と相愛を一時的に0にしたのを復帰
IF (CFLAG:653 & 16) > 0
	TALENT:76 = 1
ENDIF
IF (CFLAG:653 & 32) > 0
	TALENT:85 = 1
ENDIF
IF (CFLAG:653 & 64) > 0
	TALENT:89 = 1
ENDIF
CFLAG:653 = 0
;好感度復帰
CFLAG:2 *= -1
;-------------------------------------------------
;サーチコマンド
;-------------------------------------------------
@SEARCH_PREV_PLAY
;ゆーしすが存在しない場合はサーチ不能
SIF CFLAG:70 == 0
	RETURN 0
;コマンド実行回数(PREVCOM:981)
Y:901 = 0
;コマンド実行回数(PREVCOM:982)
Y:902 = 0
;コマンド実行回数(PREVCOM:983)
Y:903 = 0
;コマンド実行回数(PREVCOM:984)
Y:904 = 0
;コマンド実行回数(PREVCOM:985)
Y:905 = 0
;コマンド実行回数(PREVCOM:986)
Y:906 = 0
;コマンド実行回数(PREVCOM:987)
Y:907 = 0
;コマンド実行回数(PREVCOM:988)
Y:908 = 0
;コマンド実行回数(PREVCOM:989)
Y:909 = 0
;コマンド実行回数(PREVCOM:990)
Y:910 = 0
;コマンド総実行回数(981~985)
Y:911 = 0
;コマンド総実行回数(986~990)
Y:912 = 0
;コマンド総実行回数
Y:913 = 0

;コマンド最新実行日(PREVCOM:981)
U:901 = 0
;コマンド最新実行日(PREVCOM:982)
U:902 = 0
;コマンド最新実行日(PREVCOM:983)
U:903 = 0
;コマンド最新実行日(PREVCOM:984)
U:904 = 0
;コマンド最新実行日(PREVCOM:985)
U:905 = 0
;コマンド最新実行日(PREVCOM:986)
U:906 = 0
;コマンド最新実行日(PREVCOM:987)
U:907 = 0
;コマンド最新実行日(PREVCOM:988)
U:908 = 0
;コマンド最新実行日(PREVCOM:989)
U:909 = 0
;コマンド最新実行日(PREVCOM:990)
U:910 = 0
;コマンド最新実行日(981~985)
U:911 = 0
;コマンド最新実行日(986~990)
U:912 = 0
;コマンド最新実行日
U:913 = 0

;一緒に過ごした回数
A:901 = 0
;ウフフした回数
A:902 = 0
;膣射精合計回数(主人)
A:903 = 0
;A射精合計回数（主人）
A:904 = 0
;奉仕射精合計回数（主人）
A:905 = 0
;膣射精合計回数(助手)
A:906 = 0
;A射精合計回数（助手）
A:907 = 0
;奉仕射精合計回数（助手）
A:908 = 0
;C絶頂合計回数
A:909 = 0
;V絶頂合計回数
A:910 = 0
;A絶頂合計回数
A:911 = 0
;B絶頂合計回数
A:912 = 0
;噴乳合計回数
A:913 = 0
;射精合計回数
A:914 = 0
;範囲内最初に調教した日付
A:915 = 0
;範囲内最初に調教した日が昼か夜か
A:916 = 0
;最近のデート内容
A:917 = 0
;最近のプレゼント内容
A:918 = 0
;最近の調教対象
A:919 = -2
;最近の助手
A:920 = -2
;今回
U = 1
K = 0
IF (PREVCOM:991 & 1)
	CALL SEARCH_PREV
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
ENDIF
;1回前
U = 101
K = 1
IF (PREVCOM:991 & 2) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;2回前
U = 151
K = 2
IF (PREVCOM:991 & 4) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;3回前
U = 201
K = 3
IF (PREVCOM:991 & 8) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;4回前
U = 251
K = 4
IF (PREVCOM:991 & 16) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;5回前
U = 301
K = 5
IF (PREVCOM:991 & 32) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;6回前
U = 351
K = 6
IF (PREVCOM:991 & 64) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;7回前
U = 401
K = 7
IF (PREVCOM:991 & 128) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;8回前
U = 451
K = 8
IF (PREVCOM:991 & 256) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;9回前
U = 501
K = 9
IF (PREVCOM:991 & 512) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;10回前
U = 551
K = 10
IF (PREVCOM:991 & 1024) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:981 == 1998
		CALL SEARCH_PREV_DATE_MASTER
	ENDIF
	IF PREVCOM:982 == 1999
		CALL SEARCH_PREV_DATE_ASSI
	ENDIF
	IF PREVCOM:983 == 2998
		CALL SEARCH_PREV_PREZENT_MASTER
	ENDIF
	IF PREVCOM:984 == 2999
		CALL SEARCH_PREV_PRESENT_ASSI
	ENDIF
	IF PREVCOM:985 == 9998
		CALL SEARCH_PREV_TRAIN_MASTER
	ENDIF
	IF PREVCOM:986 == 9999
		CALL SEARCH_PREV_TRAIN_ASSI
	ENDIF
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;11回前
K = 11
IF (PREVCOM:991 & 2048) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;12回前
K = 12
IF (PREVCOM:991 & 4096) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;13回前
K = 13
IF (PREVCOM:991 & 8192) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;14回前
K = 14
IF (PREVCOM:991 & 16384) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;15回前
K = 15
IF (PREVCOM:991 & 32768) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
;16回前
K = 16
IF (PREVCOM:991 & 65536) && ((PREVCOM:619 == -2) || (PREVCOM:619 == PREVCOM:(600+K))) && ((PREVCOM:617 == -2) || (PREVCOM:617 == PREVCOM:(600+K)) || (PREVCOM:617 == PREVCOM:(620+K))) && ((PREVCOM:637 == -2) || ((PREVCOM:637 != PREVCOM:(600+K)) && (PREVCOM:637 != PREVCOM:(620+K)))) && (PREVCOM:618 != PREVCOM:(600+K)) && ((PREVCOM:639 == -2) || ((PREVCOM:639 == PREVCOM:(620+K)) && (PREVCOM:638 != PREVCOM:(620+K)))) && ((PREVCOM:679 == -2) || (PREVCOM:679 == PREVCOM:(660+K)))
	CALL SEARCH_PREV_RECORD
	IF PREVCOM:992 == 2
		PREVCOM:991 = -2
		PREVCOM:992 = -2
	ENDIF
ENDIF
Y:911 = Y:901 + Y:902 + Y:903 + Y:904 + Y:905
Y:912 = Y:906 + Y:907 + Y:908 + Y:909 + Y:910
Y:913 = Y:911 + Y:912

;出力決定変数
IF PREVCOM:993 > 0 && PREVCOM:993 < 10
	PREVCOM:993 *= 100
	PREVCOM:993 += 1
ELSE
	PREVCOM:993 = -2
ENDIF

Y = PREVCOM:993

IF Y > 0
	REPEAT 13
		Y:Y = Y:(COUNT + 901)
		Y += 1
	REND
ENDIF

U = PREVCOM:993

IF U > 0
	REPEAT 13
		U:U = U:(COUNT + 901)
		U += 1
	REND
ENDIF

A = PREVCOM:993

IF A > 0
	REPEAT 20
		A:A = A:(COUNT + 901)
		A += 1
	REND
ENDIF
;サーチ条件の初期化
I = 981
REPEAT 13
	PREVCOM:I = -2
	I += 1
REND
PREVCOM:617 = -2
PREVCOM:618 = -2
PREVCOM:619 = -2
PREVCOM:637 = -2
PREVCOM:638 = -2
PREVCOM:639 = -2
PREVCOM:679 = -2

@SEARCH_PREV
;日数取得用
X = PREVCOM:(640 + K)
SIF X < 0
	X *= -1
;コマンド実行回数カウント及び日数記録
REPEAT 50
	IF (PREVCOM:981 == PREVCOM:U) || (PREVCOM:981 == 1998 && PREVCOM:U >= 1000 && PREVCOM:U < 2000)
		Y:901 += 1
		SIF U:901 == 0
			U:901 = X
		SIF U:911 == 0
			U:911 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:982 == PREVCOM:U || (PREVCOM:982 == 1999 && PREVCOM:U >= 11000 && PREVCOM:U < 12000)
		Y:902 += 1
		SIF U:902 == 0
			U:902 = X
		SIF U:911 == 0
			U:911 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:983 == PREVCOM:U || (PREVCOM:983 == 2998 && PREVCOM:U >= 2000 && PREVCOM:U < 3000)
		Y:903 += 1
		SIF U:903 == 0
			U:903 = X
		SIF U:911 == 0
			U:911 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:984 == PREVCOM:U || (PREVCOM:984 == 2999 && PREVCOM:U >= 12000 && PREVCOM:U < 13000)
		Y:904 += 1
		SIF U:904 == 0
			U:904 = X
		SIF U:911 == 0
			U:911 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:985 == PREVCOM:U || (PREVCOM:985 == 9998  && PREVCOM:U >= 0 && PREVCOM:U < 10000)
		Y:905 += 1
		SIF U:905 == 0
			U:905 = X
		SIF U:911 == 0
			U:911 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:986 == PREVCOM:U || (PREVCOM:986 == 9999  && PREVCOM:U >= 10000 && PREVCOM:U < 20000)
		Y:906 += 1
		SIF U:906 == 0
			U:906 = X
		SIF U:912 == 0
			U:912 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:987 == PREVCOM:U
		Y:907 += 1
		SIF U:907 == 0
			U:907 = X
		SIF U:912 == 0
			U:912 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:988 == PREVCOM:U
		Y:908 += 1
		SIF U:908 == 0
			U:908 = X
		SIF U:912 == 0
			U:912 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:989 == PREVCOM:U
		Y:909 += 1
		SIF U:909 == 0
			U:909 = X
		SIF U:912 == 0
			U:912 = X
		SIF U:913 == 0
			U:913 = X
	ELSEIF PREVCOM:990 == PREVCOM:U
		Y:910 += 1
		SIF U:910 == 0
			U:910 = X
		SIF U:912 == 0
			U:912 = X
		SIF U:913 == 0
			U:913 = X
	ENDIF
	U += 1
REND
;打ち切りオプションがONでいずれかのコマンド実行が通った場合、次の回以降のサーチを打ち切る
IF PREVCOM:992 == 1 && (PREVCOM:981 == PREVCOM:U || PREVCOM:982 == PREVCOM:U || PREVCOM:983 == PREVCOM:U || PREVCOM:984 == PREVCOM:U || PREVCOM:985 == PREVCOM:U || PREVCOM:986 == PREVCOM:U || PREVCOM:987 == PREVCOM:U || PREVCOM:988 == PREVCOM:U || PREVCOM:989 == PREVCOM:U || PREVCOM:990 == PREVCOM:U)
	PREVCOM:992 = -1
	PREVCOM:991 = 0
ENDIF
@SEARCH_PREV_DATE_MASTER
REPEAT 50
	IF (PREVCOM:U >= 1000) && (PREVCOM:U < 2000)
		Y:901 += 1
		IF A:917 == 0
			A:917 = PREVCOM:U
		ENDIF
	ENDIF
	IF PREVCOM:992 == 1 && (PREVCOM:981 == PREVCOM:U || PREVCOM:982 == PREVCOM:U || PREVCOM:983 == PREVCOM:U || PREVCOM:984 == PREVCOM:U || PREVCOM:985 == PREVCOM:U || PREVCOM:986 == PREVCOM:U || PREVCOM:987 == PREVCOM:U || PREVCOM:988 == PREVCOM:U || PREVCOM:989 == PREVCOM:U || PREVCOM:990 == PREVCOM:U)
		PREVCOM:992 = -1
		PREVCOM:991 = 0
	ENDIF
	U += 1
REND


@SEARCH_PREV_DATE_ASSI
REPEAT 50
	IF (PREVCOM:U >= 11000) && (PREVCOM:U < 12000)
		Y:902 += 1
		IF A:917 == 0
			A:917 = PREVCOM:U
		ENDIF
	ENDIF
	IF PREVCOM:992 == 1 && (PREVCOM:981 == PREVCOM:U || PREVCOM:982 == PREVCOM:U || PREVCOM:983 == PREVCOM:U || PREVCOM:984 == PREVCOM:U || PREVCOM:985 == PREVCOM:U || PREVCOM:986 == PREVCOM:U || PREVCOM:987 == PREVCOM:U || PREVCOM:988 == PREVCOM:U || PREVCOM:989 == PREVCOM:U || PREVCOM:990 == PREVCOM:U)
		PREVCOM:992 = -1
		PREVCOM:991 = 0
	ENDIF
	U += 1
REND


@SEARCH_PREV_PREZENT_MASTER
REPEAT 50
	IF (PREVCOM:U >= 2000) && (PREVCOM:U < 3000)
		Y:903 += 1
		IF A:918 == 0
			A:918 = PREVCOM:U
		ENDIF
	ENDIF
	IF PREVCOM:992 == 1 && (PREVCOM:981 == PREVCOM:U || PREVCOM:982 == PREVCOM:U || PREVCOM:983 == PREVCOM:U || PREVCOM:984 == PREVCOM:U || PREVCOM:985 == PREVCOM:U || PREVCOM:986 == PREVCOM:U || PREVCOM:987 == PREVCOM:U || PREVCOM:988 == PREVCOM:U || PREVCOM:989 == PREVCOM:U || PREVCOM:990 == PREVCOM:U)
		PREVCOM:992 = -1
		PREVCOM:991 = 0
	ENDIF
	U += 1
REND


@SEARCH_PREV_PRESENT_ASSI
REPEAT 50
	IF (PREVCOM:U >= 11000) && (PREVCOM:U < 13000)
		Y:904 += 1
		IF A:918 == 0
			A:918 = PREVCOM:U
		ENDIF
	ENDIF
	IF PREVCOM:992 == 1 && (PREVCOM:981 == PREVCOM:U || PREVCOM:982 == PREVCOM:U || PREVCOM:983 == PREVCOM:U || PREVCOM:984 == PREVCOM:U || PREVCOM:985 == PREVCOM:U || PREVCOM:986 == PREVCOM:U || PREVCOM:987 == PREVCOM:U || PREVCOM:988 == PREVCOM:U || PREVCOM:989 == PREVCOM:U || PREVCOM:990 == PREVCOM:U)
		PREVCOM:992 = -1
		PREVCOM:991 = 0
	ENDIF
	U += 1
REND


@SEARCH_PREV_TRAIN_MASTER
REPEAT 50
	IF (PREVCOM:U >= 0) && (PREVCOM:U < 10000)
		Y:905 += 1
	ENDIF
	U += 1
REND

@SEARCH_PREV_TRAIN_ASSI
REPEAT 50
	IF (PREVCOM:U >= 10000) && (PREVCOM:U < 20000)
		Y:906 += 1
	ENDIF
	U += 1
REND

@SEARCH_PREV_RECORD
;コマンド指定で打ち切る場合は記録を取らない
SIF PREVCOM:992 == 1
	RETURN 0
A:901 += 1
A:903 += PREVCOM:(680+K)
A:904 += PREVCOM:(700+K)
A:905 += PREVCOM:(720+K)
A:906 += PREVCOM:(740+K)
A:907 += PREVCOM:(760+K)
A:908 += PREVCOM:(780+K)
A:909 += PREVCOM:(800+K)
A:910 += PREVCOM:(820+K)
A:911 += PREVCOM:(840+K)
A:912 += PREVCOM:(860+K)
A:913 += PREVCOM:(880+K)
A:914 += PREVCOM:(900+K)
IF PREVCOM:(660+K) == 1
	A:902 += 1
ENDIF
;日時記録
IF A:915 == 0
	A:915 = PREVCOM:(640 + K)
	IF A:915 < 0
		A:915 *= -1
		A:916 = 2
	ELSE
		A:916 = 1
	ENDIF
ENDIF

IF A:919 == -2
	A:919 = PREVCOM:(600 + K)
ENDIF
IF A:920 == -2
	A:920 = PREVCOM:(620 + K)
ENDIF
;----------------------------------------------------------------
;コマンド捏造関係
;一部のコマンドの地の文などをいじって、コマンドを捏造する
;TFLAG:17を利用
;以下の捏造コマンドはEVENTCOMで宣言して使う
;----------------------------------------------------------------
;一括呼び出し用
@ADDITIONAL_ALL
CALL ADDITIONAL_PETTING
CALL ADDITIONAL_ANALPETTING
CALL ADDITIONAL_BASTPETTING
CALL ADDITIONAL_KISS
CALL ADDITIONAL_SEX2
CALL ADDITIONAL_SEX3
CALL ADDITIONAL_SEX4
CALL ADDITIONAL_PAIZURI
CALL ADDITIONAL_SUMATA
CALL ADDITIONAL_LOVETALK
;----------------------------------------------------------------
;愛撫捏造
;TFLAG:17 1・2.首筋愛撫　3･4.耳愛撫　5･6.耳愛撫　7･8.ヒップ愛撫
;----------------------------------------------------------------
@ADDITIONAL_PETTING
IF SELECTCOM == 0
	;首筋愛撫
	IF RAND:4 == 0
		PRINTFORM 首筋
		IF RAND:2 == 0
			TFLAG:17 = 1
		ELSE
			TFLAG:17 = 2
		ENDIF
	;耳愛撫
	ELSEIF RAND:3 == 0
		PRINTFORM 耳
		IF RAND:2 == 0
			TFLAG:17 = 3
		ELSE
			TFLAG:17 = 4
		ENDIF
	;臍愛撫
	ELSEIF RAND:2 == 0
		PRINTFORM 臍
		IF RAND:2 == 0
			TFLAG:17 = 5
		ELSE
			TFLAG:17 = 6
		ENDIF
	;ヒップ愛撫
	ELSE
		PRINTFORM ヒップ
		IF RAND:2 == 0
			TFLAG:17 = 7
		ELSE
			TFLAG:17 = 8
		ENDIF
	ENDIF
	CALL KOJO_CUT
ENDIF

;----------------------------------------------------------------
;アナル愛撫捏造　あなうー舐めを移植しつつ、適当に改変追加
;TFLAG:17 1.アナル舐め 2.じらし移植 3.出し入れ 4.プラグ改変
;----------------------------------------------------------------
@ADDITIONAL_ANALPETTING
IF SELECTCOM == 5 && TEQUIP:90 == 0 && TEQUIP:13 == 0 && TEQUIP:63 == 0 && TEQUIP:19 == 0 && TEQUIP:46 == 0 && TEQUIP:47 == 0 && TEQUIP:48 == 0 && TEQUIP:49 == 0
	IF  RAND:4 == 0
		TFLAG:17 = 1
	ELSEIF RAND:3 == 0
		TFLAG:17 = 2
	ELSEIF RAND:2 == 0
		TFLAG:17 = 3
	ELSE
		TFLAG:17 = 4
	ENDIF
	CALL KOJO_CUT
ENDIF
;----------------------------------------------------------------
;胸愛撫捏造　要するに乳々夢コマンドの地の文の移植ですね
;TFLAG:17 1.胸揉み 2.乳首責め 3.乳首舐め 4.乳首あまがみ　5.乳首吸い　6.母乳飲み
;----------------------------------------------------------------
@ADDITIONAL_BASTPETTING
IF SELECTCOM == 5
	IF RAND:6 == 0 && TALENT:130
		TFLAG:17 = 6
	ELSEIF RAND:5 == 0
		TFLAG:17 = 1
	ELSEIF  RAND:4 == 0
		TFLAG:17 = 2
	ELSEIF RAND:3 == 0
		TFLAG:17 = 3
	ELSEIF RAND:2 == 0
		TFLAG:17 = 4
	ELSE
		TFLAG:17 = 5
	ENDIF
	CALL KOJO_CUT
ENDIF
;----------------------------------------------------------------
;キス捏造　ウフフの最中でも、ねっとりしたやつばっかりじゃなくて、たまに軽いのを混ぜるといいと思ったのです
;TFLAG:17 1.女版 2.バードキス 3.ソフトキス 4.向こうから
;----------------------------------------------------------------
@ADDITIONAL_KISS
IF SELECTCOM == 6
	IF RAND:4 == 0 && TFLAG:45
		TFLAG:17 = 4
	ELSEIF RAND:3 == 0
		PRINTFORM バード
		TFLAG:17 = 1
	ELSEIF RAND:2 == 0
		PRINTFORM ソフト
		TFLAG:17 = 2
	ELSE
		TFLAG:17 = 3
	ENDIF
	CALL KOJO_CUT
ENDIF

;----------------------------------------------------------------
;後背位捏造
;TFLAG:17 1.立ち後背位
;いわゆる立ちバックってやつ?
;----------------------------------------------------------------
@ADDITIONAL_SEX2
IF SELECTCOM == 21
	PRINTFORM 立ち
	TFLAG:17 = 1
	CALL KOJO_CUT
ENDIF

;----------------------------------------------------------------
;対面座位捏造
;TFLAG:17 1.対面立位
;いわゆる駅弁ってやつすね。｢座」位とかなっちゃうけど割り切る
;----------------------------------------------------------------
@ADDITIONAL_SEX3
IF SELECTCOM == 24
	TFLAG:17 = 1
	CALL KOJO_CUT
ENDIF

;----------------------------------------------------------------
;対面座位捏造
;TFLAG:17 1.背面立位
;しーしーすたいるとかいうんだっけか
;----------------------------------------------------------------
@ADDITIONAL_SEX4
IF SELECTCOM == 25 && TEQUIP:57 == 0
	TFLAG:17 = 1
	CALL KOJO_CUT
ENDIF

;----------------------------------------------------------------
;パイズリ捏造
;TFLAG:17 1.動いちゃう　2.突きいれ
;----------------------------------------------------------------
@ADDITIONAL_PAIZURI
IF SELECTCOM == 32
	IF TFLAG:45
		TFLAG:17 = 1
	ELSE
		TFLAG:17 = 2
	ENDIF
	CALL KOJO_CUT
ENDIF

;----------------------------------------------------------------
;素股捏造
;TFLAG:17 1.正常位素股　2.後背位素股　3．騎乗位素股
;----------------------------------------------------------------
@ADDITIONAL_SUMATA
IF SELECTCOM == 33
	IF RAND:3 == 0
		TFLAG:17 = 1
		PRINTFORM 正常位
	ELSEIF RAND:2 == 0
		TFLAG:17 = 2
		PRINTFORM 後背位
	ELSE
		TFLAG:17 = 3
		PRINTFORM 騎乗位
	ENDIF
	SIF TFLAG:17 != 3
		CALL KOJO_CUT
ENDIF
;----------------------------------------------------------------
;甘い言葉捏造　
;TFLAG:17 1. 2. 3. 4.　5.　
;----------------------------------------------------------------
@ADDITIONAL_LOVETALK
IF SELECTCOM == 311
	IF RAND:5 == 0
		TFLAG:17 = 1
	ELSEIF  RAND:4 == 0
		TFLAG:17 = 2
	ELSEIF RAND:3 == 0
		TFLAG:17 = 3
	ELSEIF RAND:2 == 0
		TFLAG:17 = 4
	ELSE
		TFLAG:17 = 5
	ENDIF
	CALL KOJO_CUT
ENDIF
;----------------------------------------------------------------
;地の文捏造
;@KOJO_MESSAGE_COMの冒頭でCALLして使う。
;----------------------------------------------------------------
;一括呼び出し用
@ADDITIONAL_MESSAGE
;元々TFLAG:17を使うコマンドのとき、地の文が生きてる時、TFLAG:17がたってないときはリターン
SIF TFLAG:17 == 0 || FLAG:6 == 1 || SELECTCOM == 302 || SELECTCOM == 197 || SELECTCOM == 198 || SELECTCOM == 199 || SELECTCOM == 186
	RETURN 0
CALL ADDITIONAL_PETTING_M
CALL ADDITIONAL_ANALPETTING_M
CALL ADDITIONAL_BASTPETTING_M
CALL ADDITIONAL_KISS_M
CALL ADDITIONAL_SEX2_M
CALL ADDITIONAL_SEX3_M
CALL ADDITIONAL_SEX4_M
CALL ADDITIONAL_PAIZURI_M
CALL ADDITIONAL_SUMATA_M
CALL ADDITIONAL_LOVETALK_M

@ADDITIONAL_PETTING_M
;愛撫
IF SELECTCOM == 0
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	;首筋愛撫
	ELSEIF TFLAG:17 == 1
		PRINTFORMW %CALLNAME:TARGET%の股間に手を伸ばしながら、首筋に舌を這わせた…
	;首筋愛撫
	ELSEIF TFLAG:17 == 2
		PRINTFORMW %CALLNAME:TARGET%の体を丹念に愛撫しながら、首筋にキスの雨を降らせた…
	;耳愛撫
	ELSEIF TFLAG:17 == 3
		PRINTFORMW %CALLNAME:TARGET%の体を丹念に愛撫しながら、可愛らしい耳を軽くあまがみした…
	;耳愛撫
	ELSEIF TFLAG:17 == 4
		PRINTFORMW %CALLNAME:TARGET%の体を丹念に愛撫しながら、可愛らしい耳を口に含み、優しく舐めた…
	;臍愛撫
	ELSEIF TFLAG:17 == 5
		PRINTFORMW %CALLNAME:TARGET%の体を丹念に愛撫しながら、臍に舌を這わせた…
	;臍愛撫
	ELSEIF TFLAG:17 == 6
		PRINTFORMW %CALLNAME:TARGET%の股間を責めながら、空いたで臍をくりくりと責めた…
	;ヒップ愛撫
	ELSEIF TFLAG:17 == 7
		PRINTFORMW %CALLNAME:TARGET%の体を丹念に愛撫しながら、尻を揉みしだいた…
	;ヒップ愛撫
	ELSEIF TFLAG:17 == 8
		PRINTFORMW %CALLNAME:TARGET%の体を丹念に愛撫しながら、尻を撫で擦った…
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF

@ADDITIONAL_ANALPETTING_M
;アナル愛撫
IF SELECTCOM == 2
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	;アナル舐め
	ELSEIF TFLAG:17 == 1
		PRINTFORM %CALLNAME:TARGET%の
			SIF EXP:Ａ経験 <= 10
			PRINT 硬く閉ざされた
		PRINT アヌスを丁寧に舐めほぐし
		SIF EXP:Ａ経験 >= 100 && PALAM:5 >= PALAMLV:3 && TEQUIP:63 == 0
			PRINT 、舌先を突き入れて穴の中までかきまわしてやっ
		PRINTW た…
	;焦らしから移植
	ELSEIF TFLAG:17 == 2
		PRINTFORMW 指を深く入れずに%CALLNAME:TARGET%の菊門の皺を指先で優しくなぞった…
	;指出し入れ
	ELSEIF TFLAG:17 == 3
		PRINTFORMW %CALLNAME:TARGET%のアナルに指を突きさすと、激しく出し入れしてやった…
	;電極改変
	ELSEIF TFLAG:17 == 4
		PRINTFORMW 指を思いっきり突き刺すと菊穴をグリグリとこねくりまわした…
	;逆アナル愛撫
	ELSEIF TFLAG:17 == 11
		IF EXP:PLAYER:Ａ経験 < 5
			PRINTFORMW %CALLNAME:TARGET%は%CALLNAME:MASTER%の顔に苦痛の声を漏らすのにも構わず、アナルに指を入れ、弄った…
		ELSEIF EXP:PLAYER:Ａ経験 < 20
			PRINTFORML %CALLNAME:TARGET%は%CALLNAME:MASTER%のアナルに指を突き入れると、グニグニと動かした。
			PRINTFORMW そして、%CALLNAME:MASTER%の顔に苦痛と僅かな悦楽の色が浮かぶの見て、妖しく微笑んだ…
		ELSE
			PRINTFORM %CALLNAME:TARGET%は%CALLNAME:MASTER%のアナルを弄って、指先で直腸までかきまわした…
		ENDIF
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF
@ADDITIONAL_BASTPETTING_M
;胸愛撫　絶壁・爆乳・焦らしプレイの地の文はカットしてます
IF SELECTCOM == 5
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	;胸揉み
	ELSEIF TFLAG:17 == 1
		IF TALENT:130
			PRINTFORM %CALLNAME:TARGET%の
			SIF PALAM:5 > PALAMLV:3
				PRINT 期待に震える
			IF TALENT:100 && TALENT:109
				PRINT 僅かに膨らみが感じられる程度の
			ELSEIF TALENT:109
				PRINT 標準よりやや小さめの
			ELSEIF TALENT:110
				PRINT 手から溢れそうなほどの
			ENDIF
			IF TEQUIP:63
				PRINTFORMW 胸を下からそっと揉み上げた…
			ELSEIF PALAM:5 > PALAMLV:3 && TALENT:85
				PRINTW 胸を強く搾り上げてやると、
				PRINTFORM %CALLNAME:TARGET%は嬌声をあげて
				IF TALENT:109
					PRINT その控えめな
				ELSEIF TALENT:110
					PRINT その大きな
				ELSEIF TALENT:141
					PRINT その巨大な
				ENDIF
				SIF TALENT:130
					PRINT 母乳が滴る
				PRINTL 胸を強調するように突き出し、
				PRINTW より強い刺激を求めた…
			ELSEIF PALAM:5 > PALAMLV:3
				PRINTW 胸を強く搾り上げた…
			ELSE
				PRINTW 胸を搾り上げた…
			ENDIF
		ELSE
			PRINTFORM %CALLNAME:TARGET%の
			SIF PALAM:5 > PALAMLV:3
				PRINT 期待に震える
			IF TALENT:100 && TALENT:109
				PRINT 僅かに膨らみが感じられる程度の
			ELSEIF TALENT:109
				PRINT 標準よりやや小さめの
			ELSEIF TALENT:110
				PRINT 手から溢れそうなほどの
			ENDIF
			IF PALAM:5 > PALAMLV:3 && TALENT:85
				PRINTL 胸を優しく撫でてやると、
				PRINTFORMW %CALLNAME:TARGET%は少し恥ずかしそうにしながら胸を突き出すようにして激しい愛撫を求めた…
			ELSEIF TALENT:140
				PRINTW 胸を優しく撫でるように触れた…
			ELSEIF TEQUIP:63
				PRINTFORMW 胸を下からそっと揉み上げた…
			ELSEIF PALAM:5 > PALAMLV:3 && TALENT:85
				PRINTW 胸を強く揉みしだいてやると、
				PRINTFORM %CALLNAME:TARGET%は嬌声をあげて
				IF TALENT:109
					PRINT その控えめな
				ELSEIF TALENT:110
					PRINT その大きな
				ENDIF
				SIF TALENT:130
					PRINT 母乳が滴る
				PRINTL 胸を強調するように突き出し、
				PRINTW より強い愛撫を求めた…
			ELSEIF PALAM:5 > PALAMLV:3
				PRINTW 胸を強く揉みしだいた…
			ELSE
				PRINTW 胸を揉みしだいた…
			ENDIF
		ENDIF
	ELSEIF TFLAG:17 == 2
		PRINTFORM %CALLNAME:TARGET%の
		IF TALENT:100 && TALENT:109
			PRINT 僅かに膨らみが感じられる程度の
		ELSEIF TALENT:109
			PRINT 標準よりやや小さめの
		ELSEIF TALENT:110
			PRINT 手から溢れそうなほどの
		ENDIF
		IF PALAM:5 > PALAMLV:3
			PRINT 胸の先端の、
			PRINTW すっかり硬くなった突起をつまみあげた…
		ELSE
			PRINT 胸の先端の、
			PRINTW まだ柔らかい突起をつまみあげた…
		ENDIF
	;乳首舐め/乳首あまがみ
	ELSEIF TFLAG:17 == 3 || TFLAG:17 == 4
		PRINTFORM %CALLNAME:TARGET%の
		IF TALENT:100 && TALENT:109
			PRINT 僅かに膨らみが感じられる程度の
		ELSEIF TALENT:109
			PRINT 標準よりやや小さめの
		ELSEIF TALENT:110
			PRINT 手から溢れそうなほどの
		ENDIF
		PRINT 胸の先端の、
		IF PALAM:5 > PALAMLV:3
			PRINT すっかり硬くなった突起
		ELSE
			PRINT まだ柔らかい突起
		ENDIF
		IF TFLAG:17 == 4
			PRINTW に歯を立てて甘噛みした…
		ELSEIF TALENT:PLAYER:54
			PRINTW に舌の棘を押し当てた…
		ELSE
			PRINTW を舐めあげた…
		ENDIF
	;乳首吸い
	ELSEIF TFLAG:17 == 5
		PRINTFORM %CALLNAME:TARGET%の
		IF TALENT:100 && TALENT:109
			PRINT 僅かに膨らみが感じられる程度の
		ELSEIF TALENT:109
			PRINT 標準よりやや小さめの
		ELSEIF TALENT:110
			PRINT 手から溢れそうなほどの
		ENDIF
		IF RAND:2 == 0
			IF PALAM:5 > PALAMLV:3 && TALENT:85
				PRINTL 期待に震える胸の先端を
				PRINTW 強く赤子のように吸い上げると、
				PRINTFORM %CALLNAME:TARGET%は嬌声をあげて
				IF TALENT:109
					PRINT その控えめな
				ELSEIF TALENT:110
					PRINT その大きな
				ENDIF
				SIF TALENT:130
					PRINT 母乳が滴る
				PRINTFORML 胸を強調するように突き出し、
				PRINTFORMW %CALLNAME:PLAYER%の顔に押し付けた…
			ELSEIF PALAM:5 > PALAMLV:3
				PRINTW 胸の先端の、すっかり硬くなった突起を吸いあげた…
			ELSE
				PRINTW 胸の先端の、まだ柔らかい突起を吸いあげた…
			ENDIF
		ELSE
			IF TALENT:130
				IF PALAM:5 > PALAMLV:3
					PRINTW 先端の、勃起しきった突起から母乳を吸い出そうとした…
				ELSE
					PRINTW 先端から母乳を吸い出そうとした…
				ENDIF
			ELSE
				IF PALAM:5 > PALAMLV:3
					PRINTW 先端の、勃起しきった突起を甘噛みしつつ吸い上げた…
				ELSE
					PRINTW 先端を口内でねぶった…
				ENDIF
			ENDIF
		ENDIF
	ELSEIF TFLAG:17 == 6
		PRINTFORM %CALLNAME:TARGET%の
		IF TALENT:100 && TALENT:109
			PRINT 僅かに膨らみが感じられる程度の
		ELSEIF TALENT:109
			PRINT 標準よりやや小さめの
		ELSEIF TALENT:110
			PRINT 手から溢れそうなほどの
		ENDIF
		IF PALAM:5 > PALAMLV:3 && TALENT:85
			PRINTL 胸を絞り込むようにしながら
			PRINTW その先端を強く吸い上げると、
			PRINTFORM %CALLNAME:TARGET%は嬌声をあげながらも
			IF TALENT:109
				PRINT その控えめな
			ELSEIF TALENT:110
				PRINT その大きな
			ENDIF
			PRINT 胸
			SIF TALENT:110
				PRINT の谷間
			PRINTFORML に%CALLNAME:PLAYER%の頭を寄せ、
			PRINTFORMW 快感で力が入ってしまうのか強く抱きしめ圧迫した…
		ELSEIF PALAM:5 > PALAMLV:3 && TALENT:76
			PRINTW 胸を絞り込むようにしながらその先端を強く吸い上げると、
			PRINTFORM %CALLNAME:TARGET%は嬌声をあげて
			IF TALENT:109
				PRINT その控えめな
			ELSEIF TALENT:110
				PRINT その大きな
			ENDIF
			PRINTFORML 胸を強調するように突き出し、
			PRINTFORMW %CALLNAME:PLAYER%の顔に押し付けた…
		ELSEIF TALENT:85
			PRINTW 胸を揉みしだきながらその先端を吸い上げると、
			PRINTFORM %CALLNAME:TARGET%は優しい笑みを浮かべ
			IF TALENT:109
				PRINT その控えめな
			ELSEIF TALENT:110
				PRINT その大きな
			ENDIF
			PRINT 胸
			SIF TALENT:110
				PRINT の谷間
			PRINTFORML に%CALLNAME:PLAYER%の頭を寄せ、
			PRINTFORMW 優しく抱きしめた…
		ELSE
			PRINTW 胸の先端を吸いあげ母乳を飲んだ…
		ENDIF
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF

@ADDITIONAL_KISS_M
IF SELECTCOM == 6
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	ELSEIF TFLAG:17 == 1
		PRINTFORMW %CALLNAME:TARGET%の口腔を隅々まで舐め回し、ねっとりと舌を絡めあいながら唾液を交換した…
	ELSEIF TFLAG:17 == 2
		PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:TARGET%に軽く啄ばむように口づけた…
	ELSEIF TFLAG:17 == 3
		PRINTFORM %CALLNAME:PLAYER%は%CALLNAME:TARGET%に優しく
		SIF TALENT:153
			PRINTFORM 、愛情をこめて
		PRINTFORMW キスをした…
	ELSE
		PRINTFORMW %CALLNAME:TARGET%は%CALLNAME:PLAYER%に抱きついて、唇を塞ぎ、激しく舌を吸ってきた…
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF

@ADDITIONAL_SEX2_M
IF SELECTCOM == 21
	;立ち後背位
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	ELSEIF TFLAG:17 == 1
		;前回と今回の調教者が同じで、前回の調教が後背位であり、抜かないフラグがある場合
		IF TFLAG:60 && PREVCOM == 21 && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			;調教者がオトコか半人半妖かふたなりである
			IF TALENT:PLAYER:119 || TALENT:PLAYER:121 || TALENT:PLAYER:122
				PRINTFORMW %CALLNAME:TARGET%に壁を手をつかせて立たせると、膣内の感触を味わいながら、再び腰を動かし始めた…
			ELSE
			;ペニスバンドを使用している場合
				PRINTFORMW %CALLNAME:TARGET%の膣内から抜かずに、壁を手をつかせて立たせると、再び腰を動かし始めた…
			ENDIF
			SIF TFLAG:31
				TFLAG:31 = 2
		;同様に、前回の調教が正常位である場合
		ELSEIF TFLAG:60 && PREVCOM == 20 && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			PRINTFORMW 膣内から抜き去ることなく%CALLNAME:TARGET%に後ろに回り、壁に手をつかせて、立たせると再び腰を動かし始めた…
			SIF TFLAG:31
				TFLAG:31 = 2
		;同様に、前回の調教が対面座位、背面座位、騎乗位である場合
		ELSEIF TFLAG:60 && (PREVCOM == 24 || PREVCOM == 25 || PREVCOM == 34) && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			PRINTFORMW 挿入したまま%CALLNAME:TARGET%に壁に手をつかせて立たせると、再び腰を動かし始めた…
			SIF TFLAG:31
				TFLAG:31 = 2
		ELSE
			PRINTFORM %CALLNAME:TARGET%に壁に手をつかせて立たせると、後ろから
			IF TALENT:100
				PRINT 幼いワレメ
			ELSE
				PRINT 秘裂
			ENDIF
			PRINTFORMW の最奥まで突き入れた…
		ENDIF
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF
@ADDITIONAL_SEX3_M
;対面座位
IF SELECTCOM == 24
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	;対面立位
	ELSEIF TFLAG:17 == 1
		;前回と今回の調教者が同じで、前回の調教が対面座位であり、抜かないフラグがある場合
		IF TFLAG:60 && PREVCOM == 24 && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			PRINTFORMW %CALLNAME:TARGET%は%CALLNAME:PLAYER%とキスをし、舌を絡めながら再び腰を揺すり始めた…
		;同様に前回の調教が正常位、騎乗位の場合
		ELSEIF TFLAG:60 && (PREVCOM == 20 || PREVCOM == 34) && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			PRINTFORM 膣内からペニスを抜き去ることなく%CALLNAME:TARGET%の身体を
			IF PREVCOM == 20
				PRINT 抱いたまま、
			ELSE
				PRINT 抱き寄せ、
			ENDIF
			PRINTFORMW 立ち上がり、腰を揺すり始めた…
		;同様に前回の調教が後背位、背面座位の場合
		ELSEIF TFLAG:60 && (PREVCOM == 21 || PREVCOM == 25) && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			PRINTFORM 挿入したまま身体をこちらに向かせ
			IF PREVCOM == 21
				PRINT て抱き、
			ELSE
				PRINT ると抱き寄せ、
			ENDIF
			PRINTFORMW 立ち上がって、腰を揺すり始めた…
		ELSE
			PRINTFORM %CALLNAME:TARGET%の
			SIF PALAM:3 >= PALAMLV:4
				PRINT 濡れそぼった
			IF TALENT:100
				PRINT 幼いワレメ
			ELSE
				PRINT 秘裂
			ENDIF
			PRINTFORMW に挿入し、抱いたまま、立ち上がって、腰を揺すり始めた…
		ENDIF
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF

@ADDITIONAL_SEX4_M
;背面座位
IF SELECTCOM == 25
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	;背面立位
	ELSEIF TFLAG:17 == 1
		;前回と今回の調教者が同じで、前回の調教が背面座位であり、抜かないフラグがある場合
		IF TFLAG:60 && PREVCOM == 25 && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			PRINTFORMW %CALLNAME:TARGET%を背後から抱きしめ、そのまま立ち上がって、再び%CALLNAME:TARGET%の身体を揺らし始めた…
		;同様に、前回の調教が後背位か騎乗位である場合
		ELSEIF TFLAG:60 && (PREVCOM == 21 || PREVCOM == 34) && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
			PRINTFORMW 膣内からペニスを抜き去ることなく%CALLNAME:TARGET%の身体を抱いたまま、立ち上がり、激しく身体を揺さぶり始めた…
		;同様に、前回の調教が正常位か対面座位である場合
		ELSEIF TFLAG:60 && (PREVCOM == 20 || PREVCOM == 24) && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))	
			PRINTFORM 挿入したまま反対を向かせた%CALLNAME:TARGET%の身体を
			IF PREVCOM == 20
				PRINT 抱いたまま、
			ELSE
				;PREVCOM == 24
				PRINT 抱き寄せ、
			ENDIF
			PRINTFORML 立ち上がり、腰を揺さぶり始めた…
		ELSE
			PRINTFORM %CALLNAME:TARGET%の、
			SIF PALAM:3 >= PALAMLV:4
				PRINT 濡れそぼった
			IF TALENT:100
				PRINT 幼いワレメ
			ELSE
				PRINT 秘裂
			ENDIF
			PRINTFORMW に後ろから挿入し、そのまま立ち上がった…
		ENDIF
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF
@ADDITIONAL_PAIZURI_M
;パイズリ
IF SELECTCOM == 32
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	ELSEIF TFLAG:17 == 1
		PRINTFORM %CALLNAME:MASTER%は%CALLNAME:TARGET%の
		IF TALENT:109
			PRINT 薄い
		ELSEIF TALENT:110
			PRINT 豊満な
		ENDIF
		PRINT 胸にペニスを
		IF TALENT:109
			PRINT 押し付けると、激しく擦り付けた…
		ELSE
			PRINTFORMW 突き入れると、激しく腰を振りたてた…
		ENDIF
	ELSE
		PRINTFORM %CALLNAME:TARGET%は
		IF TALENT:109
			PRINT 薄い胸にペニスを当てさせると
		ELSEIF TALENT:110
			PRINT 豊満な胸でペニスを包み込むと
		ELSE
			PRINT 胸でペニスをはさむと
		ENDIF
		PRINTFORMW 動きを止めて、%CALLNAME:MASTER%を見て微笑んだ…
		PRINTFORM %CALLNAME:MASTER%は少し待ったが堪えきれなくなり、自ら腰を振って、
		IF TALENT:109
			PRINT ペニスを胸に擦りつけはじめた…
		ELSE
			PRINTFORMW 、快楽を貪りはじめた…
		ENDIF
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF
@ADDITIONAL_SUMATA_M
;素股
IF SELECTCOM == 32
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	ELSEIF TFLAG:17 == 1
		PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:TARGET%を寝かせると、太腿の間にペニスを挿し入れ、腰を動かし始めた…
	ELSEIF TFLAG:17 == 2
		PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:TARGET%を四つんばいにさせると、股の間にペニスを挿し入れ、激しく腰を振り始めた…
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF
@ADDITIONAL_LOVETALK_M
;甘い言葉
IF SELECTCOM == 311
	PRINTL  
	IF TFLAG:17 == 0
		RETURN 0
	ELSEIF RAND:4 && TFLAG:45
		PRINTFORMW %CALLNAME:TARGET%は頬を赤らめ、%CALLNAME:PLAYER%に甘い言葉をねだってきた。
		TFLAG:17 = 4
	ELSEIF RAND:3
		PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:TARGET%の耳元でそっと愛を囁いた。
		TFLAG:17 = 3
	ELSEIF RAND:2
		PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:TARGET%の美しさを雄弁に褒め称えた。
		TFLAG:17 = 2
	ELSE
		PRINTFORMW %CALLNAME:PLAYER%は自分の想いを詩にして、%CALLNAME:TARGET%に贈った。
		TFLAG:17 = 1
	ENDIF
	CALL KOJO_CUT_RETURN
ENDIF
;----------------------------------------------------------------
;ソース捏造
;@KOJO_MESSAGE_COM内でCALLして使う。
;----------------------------------------------------------------
@ADDITIONAL_SOUCRE
IF SELECTCOM == 2 && TFLAG:17 == 11
	SOURCE:2 = 0
	SOURCE:6 = 0
	SOURCE:12 = 0
	SOURCE:13 = 0
	SOURCE:14 = 0
	EXP:Ａ経験 -= 1
	EXP:PLAYER:Ａ経験 += 1
;-------------------------------------------------
;射精ゲージチェック
;-------------------------------------------------
	B = 0
	;ABL:技巧をみる
	IF ABL:技巧 <= 1
		B = 200 + ABL:技巧 * 100
	ELSEIF ABL:技巧 <= 3
		B = 300 + ABL:技巧 * 100
	ELSEIF ABL:技巧 <= 5
		B = 300 + ABL:技巧 * 150
	ELSEIF ABL:技巧 <= 8
		B = 500 + ABL:技巧 * 150
	ELSEIF ABL:技巧 <= 11
		B = 200 + ABL:技巧 * 200
	ELSE
		B = 500 + ABL:技巧 * 200
	ENDIF
	;ABL:従順をみる
	IF ABL:親密 <= 1
		TIMES B , 0.80
	ELSEIF ABL:親密 <= 3
		TIMES B , 0.90
	ELSEIF ABL:親密 <= 5
		TIMES B , 1.00
	ELSEIF ABL:親密 <= 8
		TIMES B , 1.10
	ELSEIF ABL:親密 <= 11
		TIMES B , 1.20
	ELSE
		B = B * (ABL:親密 * 2 + 105) / 100
	ENDIF

	;ABL:奉仕精神をみる
	IF ABL:奉仕精神 <= 1
		TIMES B , 0.50
	ELSEIF ABL:奉仕精神 <= 3
		TIMES B , 0.80
	ELSEIF ABL:奉仕精神 <= 5
		TIMES B , 1.20
	ELSEIF ABL:奉仕精神 <= 8
		TIMES B , 1.50
	ELSEIF ABL:奉仕精神 <= 11
		TIMES B , 1.80
	ELSE
		B = B * (ABL:奉仕精神 * 10 + 90) / 100
	ENDIF

	;プレイヤーのA経験をみる
	IF EXP:PLAYER:Ａ経験 < 5
		TIMES B , 0.10
	ELSEIF EXP:PLAYER:Ａ経験 < 20
		TIMES B , 0.30
	ELSEIF EXP:PLAYER:Ａ経験 < 40
		TIMES B , 1.00
	ELSEIF EXP:PLAYER:Ａ経験 < 80
		TIMES B , 2.50
	ELSEIF EXP:PLAYER:Ａ経験 < 150
		TIMES B , 4.00
	ELSEIF EXP:PLAYER:Ａ経験 < 300
		TIMES B , 7.00
	ELSE
		TIMES B , 10.00
	ENDIF

	SIF TALENT:PLAYER:119 || TALENT:PLAYER:122  || TALENT:PLAYER:121
		BASE:PLAYER:射精 += B

	SOURCE:8 = 200
	;ABL:奉仕精神をみる
	IF ABL:奉仕精神 == 0
		SOURCE:4 = 200
		SOURCE:5 = 50
		TIMES SOURCE:8 , 4.00
	ELSEIF ABL:奉仕精神 == 1
		SOURCE:4 = 250
		SOURCE:5 = 100
		TIMES SOURCE:8 , 2.50
	ELSEIF ABL:奉仕精神 == 2
		SOURCE:4 = 300
		SOURCE:5 = 200
		TIMES SOURCE:8 , 1.50
	ELSEIF ABL:奉仕精神 == 3
		SOURCE:4 = 350
		SOURCE:5 = 300
		TIMES SOURCE:8 , 1.00
	ELSEIF ABL:奉仕精神 == 4
		SOURCE:4 = 450
		SOURCE:5 = 500
		TIMES SOURCE:8 , 0.50
	ELSE
		SOURCE:4 = 300 + (ABL:奉仕精神 * 25)
		SOURCE:5 = 125 + (ABL:奉仕精神 * 125)
		TIMES SOURCE:8 , 0.10
	ENDIF


	;ABL:技巧をみる
	IF ABL:技巧 == 0
		TIMES SOURCE:4 , 0.50
		TIMES SOURCE:5 , 0.50
	ELSEIF ABL:技巧 == 1
		TIMES SOURCE:4 , 0.80
		TIMES SOURCE:5 , 0.80
	ELSEIF ABL:技巧 == 2
		TIMES SOURCE:4 , 1.00
		TIMES SOURCE:5 , 1.00
	ELSEIF ABL:技巧 == 3
		TIMES SOURCE:4 , 1.20
		TIMES SOURCE:5 , 1.20
	ELSEIF ABL:技巧 == 4
		TIMES SOURCE:4 , 1.50
		TIMES SOURCE:5 , 1.50
	ELSE
		SOURCE:4 = SOURCE:4 * (ABL:技巧 * 25 + 75) / 100
		SOURCE:5 = SOURCE:5 * (ABL:技巧 * 25 + 75) / 100
	ENDIF
	
	;ABL:サドっ気をみる
	IF ABL:サドっ気 == 0
		SOURCE:20 = 1600
	ELSEIF ABL:サドっ気 == 1
		SOURCE:20 = 2200
	ELSEIF ABL:サドっ気 == 2
		SOURCE:20 = 2800
	ELSEIF ABL:サドっ気 == 3
		SOURCE:20 = 3600
	ELSEIF ABL:サドっ気 == 4
		SOURCE:20 = 4600
	ELSE
		SOURCE:20 = 2000 + (ABL:サドっ気 * 700)
	ENDIF
	
	CALL SAMEN_CHECK
	
	IF E >= 1
	;射精している
		TIMES SOURCE:4 , 3.00

		;ABL:精液中毒をみる
		IF ABL:精液中毒 == 0
			SOURCE:7 = 0
			TIMES SOURCE:5 , 2.00
			TIMES SOURCE:13, 2.00
		ELSEIF ABL:精液中毒 == 1
			SOURCE:7 = 200
			TIMES SOURCE:5 , 2.50
			TIMES SOURCE:13, 1.60
		ELSEIF ABL:精液中毒 == 2
			SOURCE:7 = 600
			TIMES SOURCE:5 , 3.00
			TIMES SOURCE:13, 1.00
		ELSEIF ABL:精液中毒 == 3
			SOURCE:7 = 1500
			TIMES SOURCE:5 , 4.00
			TIMES SOURCE:13, 0.70
		ELSEIF ABL:精液中毒 == 4
			SOURCE:7 = 3000
			TIMES SOURCE:5 , 5.00
			TIMES SOURCE:13, 0.40
		ELSE
			SOURCE:7 = (ABL:精液中毒 * 1500) - 1000
			SOURCE:5 = SOURCE:5 * (ABL:精液中毒 * 50 + 350) / 100
			TIMES SOURCE:13, 0.10
		ENDIF
		
		;射精先タイプの設定
		TFLAG:703 = 3
		;射精先選択の可・不可
		TFLAG:704 = 0
		;汎用的な処理はこの関数で行う
		;（射精ゲージの再計算や射精経験の上昇と共通部分の表示）
		CALL SAMEN_SHOOT
	ENDIF

;奴隷の指⇔調教者のAの汚れが移動
	STAIN:1 |= STAIN:PLAYER:2
	STAIN:PLAYER:4 |= STAIN:1

	IF TALENT:122 == 0 && TALENT:PLAYER:122 == 0
		PRINTS EXPNAME:40
		PRINTL +4
		EXP:レズ経験 += 4
		EXP:PLAYER:レズ経験 += 4
	ELSEIF TALENT:122 == 1 && TALENT:PLAYER:122 == 1
		PRINTS EXPNAME:41
		PRINTL +4
		EXP:ＢＬ経験 += 4
		EXP:PLAYER:ＢＬ経験 += 4
	ENDIF

	TFLAG:100 = 1

	;調教者がふたなり
	IF TALENT:PLAYER:121
		SOURCE:13 /= 2
	ENDIF
ENDIF
;-------------------------------------------------
;ゆーぱっく機能
;サーチ条件をある程度まとめてみたもの
;いちいち条件つくるのめんどいひとむけというか、相当めんどいので利用するのもありだとおもいます…
;-------------------------------------------------
@SEARCH_PREV_KOJO2
CALL SEARCH_PREV_ETC
CALL SEARCH_PREV_HAVE_A_TIME
CALL SEARCH_PREV_DATE
CALL SEARCH_PREV_PRESENT
CALL SEARCH_PREV_HOUSEWORK
CALL SEARCH_PREV_MAKELOVE

@SEARCH_PREV_ETC
;調教10回以内のパートナーとすごした様々なコマンドの有無をサーチ
PREVCOM:991 = 2046
PREVCOM:993 = 1
PREVCOM:619 = NO:TARGET
PREVCOM:981 = 1998
PREVCOM:982 = 300
PREVCOM:983 = 2998
PREVCOM:984 = 301
PREVCOM:985 = 321
PREVCOM:986 = 340
PREVCOM:987 = 341
PREVCOM:988 = 342
CALL SEARCH_PREV_PLAY
;出力される変数について
;Y:101 U:101　デート回数　および最近実行日
;Y:102 U:102　戦闘訓練回数　および最近実行日
;Y:103 U:103　プレゼント回数　および最近実行日
;Y:104 U:104　会話回数　および最近実行日
;Y:105 U:105　遊びに行った回数　および最近実行日
;Y:106 U:106　バードキス回数　および最近実行日
;Y:107 U:107　ソフトキス回数　および最近実行日
;Y:108 U:108　ディープキス回数　および最近実行日
;Y:112 U:112　純愛モードキス回数　および最近実行日
;A:101 パートナーと一緒に過ごした回数
;A:102 パートナーとウフフした回数
@SEARCH_PREV_HAVE_A_TIME
;16回以内でパートナーと一緒にいた日を調べる(助手・対象どちらかとしていた日)
PREVCOM:991 = 131070
PREVCOM:993 = 2
PREVCOM:617 = NO:TARGET
CALL SEARCH_PREV_PLAY
;出力される変数について
;A:201 一緒に過ごした回数
;A:202 ウフフした回数
;A:215 最後に一緒にすごした日付
;A:216 最後に一緒に過ごした日の時刻（1、昼　2、夜）
;A:219 最近の調教対象
;A:220 最近の前の助手

@SEARCH_PREV_DATE
;最近のデート履歴をサーチ
;一応捜査範囲は5回以内で最近デートにいった日
PREVCOM:991 = 62
PREVCOM:992 = 1
PREVCOM:993 = 3
PREVCOM:619 = NO:TARGET
PREVCOM:981 = 1998
CALL SEARCH_PREV_PLAY
;出力される変数について
;Y:301 デートにいったかどうか　いっていれば1以上
;U:301 デートに行った日付。U:301 = (DAY+1)で午前中、U:301 = DAYで昨日、U:301 <= (DAY - 1)なら2日以上前などとなる
;A:302 その日にウフフがあったかどうか
;A:320 その日の助手(いなかったら0)
;A:317 デートの内容 1000+方式
@SEARCH_PREV_PRESENT
;最近のプレゼント履歴をサーチ
;一応捜査範囲は5回以内
PREVCOM:991 = 62
PREVCOM:992 = 1
PREVCOM:993 = 4
PREVCOM:619 = NO:TARGET
PREVCOM:983 = 2998
CALL SEARCH_PREV_PLAY

;出力される変数について
;Y:403 プレゼントを贈ったかどうか　贈ってれば1以上
;U:403 プレゼントを贈った日付。U:403 = (DAY+1)で午前中、U:403 = DAYで昨日、U:403 <= (DAY - 1)なら2日以上前などとなる
;A:418 プレゼントの内容 2000+方式
;A:420 その日の助手(いなかったら0)
@SEARCH_PREV_HOUSEWORK
;調教10回以内に家事があったかどうかをサーチ
;ついでに前回の助手と対象も取れるのでここで取得
PREVCOM:991 = 2046
PREVCOM:993 = 5
PREVCOM:981 = 305
CALL SEARCH_PREV_PLAY
;出力される変数について
;Y:501 家事を実行した回数
;A:502 ウフフがあった回数
;U:501 最後に家事をした日、U:501 >= (DAY - 6)なら一週間家事がなかったことになる
;A:519 1回前の対象
;A:520 1回前の助手

@SEARCH_PREV_MAKELOVE
;最近のウフフ事情(16回以内で直近の助手・対象どちらかとしていた日を調査)
PREVCOM:991 = 131070
PREVCOM:992 = 2
PREVCOM:993 = 6
PREVCOM:679 = 1
PREVCOM:617 = NO:TARGET
CALL SEARCH_PREV_PLAY
;出力される変数について
;A:603;膣射精合計回数(主人)
;A:604;A射精合計回数（主人）
;A:605;奉仕射精合計回数（主人）
;A:606;膣射精合計回数(助手)
;A:607;A射精合計回数（助手）
;A:608;奉仕射精合計回数（助手）
;A:609;C絶頂合計回数
;A:610;V絶頂合計回数
;A:611;A絶頂合計回数
;A:612;B絶頂合計回数
;A:613;噴乳合計回数
;A:614;射精合計回数
;A:615 ウフフした日付
;A:616 ウフフした日の時刻（0、してない　1、昼　2、夜）
;A:619 最近の調教対象
;A:620 最近の前の助手

@SEARCH_PREV_EVENTCOM
CALL SEARCH_PREV_PLAY1
CALL SEARCH_PREV_PLAY2
CALL SEARCH_PREV_PLAY3
CALL SEARCH_PREV_PLAY4
@SEARCH_PREV_PLAY1
;今回調教における愛撫系とセックス系をチェック
PREVCOM:991 = 1
PREVCOM:993 = 1
PREVCOM:981 = 0
PREVCOM:982 = 1
PREVCOM:983 = 5
PREVCOM:984 = 8
PREVCOM:985 = 10
PREVCOM:986 = 20
PREVCOM:987 = 21
PREVCOM:988 = 24
PREVCOM:989 = 25
PREVCOM:990 = 34
CALL SEARCH_PREV_PLAY
;出力される変数について
;Y:101 愛撫
;Y:102 クンニ
;Y:103 胸愛撫
;Y:104 指挿入
;Y:105 ロータ－
;Y:106 正常位
;Y:107 後背位
;Y:108 対面座位
;Y:109 背面座位
;Y:110 騎乗位
;Y:111 愛撫系合計回数
;Y:112 セックス系合計回数

@SEARCH_PREV_PLAY2
;今回調教における奉仕系とキス系をチェック
PREVCOM:991 = 1
PREVCOM:993 = 2
PREVCOM:981 = 30
PREVCOM:982 = 31
PREVCOM:983 = 32
PREVCOM:984 = 33
PREVCOM:985 = 35
PREVCOM:986 = 6
PREVCOM:987 = 340
PREVCOM:988 = 341
PREVCOM:989 = 342
CALL SEARCH_PREV_PLAY
;出力される変数について
;Y:201 手淫
;Y:202 フェラチオ
;Y:203 パイズリ
;Y:204 素股
;Y:205 泡踊り
;Y:206 キス
;Y:207 バードキス
;Y:208 ソフトキス
;Y:209 ディープキス
;Y:211 奉仕系合計回数
;Y:212 キス系合計回数

@SEARCH_PREV_PLAY3
;今回調教におけるアナル系をチェック
PREVCOM:991 = 1
PREVCOM:993 = 3
PREVCOM:981 = 22
PREVCOM:982 = 26
PREVCOM:983 = 27
PREVCOM:984 = 28
PREVCOM:985 = 29
PREVCOM:986 = 36
PREVCOM:987 = 2
CALL SEARCH_PREV_PLAY
Y:311 += Y:306
;出力される変数について
;Y:301 アナルセックス
;Y:302 アナル正常位
;Y:303 アナル後背位
;Y:304 アナル対面座位
;Y:305 アナル背面座位
;Y:306 アナル騎乗位
;Y:307 アナル愛撫
;Y:311 アナルセックス系合計回数
;Y:313 アナル系合計回数（アナルセックス系＋アナル愛撫）

@SEARCH_PREV_PLAY4
;今回調教におけるSM系をチェック
PREVCOM:991 = 1
PREVCOM:993 = 4
PREVCOM:981 = 3040
PREVCOM:982 = 3041
PREVCOM:983 = 3042
PREVCOM:984 = 37
PREVCOM:985 = 3075
PREVCOM:986 = 40
PREVCOM:987 = 41
PREVCOM:988 = 42
PREVCOM:989 = 75
CALL SEARCH_PREV_PLAY
;出力される変数について
;Y:401 スパンキング(S)
;Y:402 鞭(S)
;Y:403 針(S)
;Y:404 足扱き(S)
;Y:405 言葉責め(S)
;Y:406 スパンキング(M)
;Y:407 鞭(M)
;Y:408 針(M)
;Y:409 言葉責め(M)
;Y:411 S系合計回数
;Y:412 M系合計回数
;-------------------------------------------------
;共通の実行判定処理関数
;要するにCOM_ORDERのマスク版です
;-------------------------------------------------
@MASK_COM_ORDER
;各コマンドの固有実行判定を呼び出す
;その際に実行判定非表示を利用し文章は非表示にする
;実行判定非表示がOFFの場合は一時的にONにし処理後OFFに戻す
LOCAL = 0
IF ((FLAG:23 & 1p27) == 0) && FLAG:2 != 1
	FLAG:23 |= 1p27
	;LOCALを戻すのに利用する
	LOCAL = 1
ENDIF
;各コマンドの固有実行判定
TRYCALLFORM COM_ORDER_{SELECTCOM}

;実行判定非表示を一時的にONにしていた場合OFFに戻す
SIF LOCAL
	FLAG:23 -= 1p27

;実行できる場合はZ = 1にする
Z = 1
;実行できない
SIF A < V
	Z = 0
;装備系解除時は無条件に実行可能（固有実行判定の方に必ず実行可能になるよう処理追加）
RETURN 0
