@COM_ABLE172
;暗闇
;いまのところ使い手なし
RETURN 0

CALL COM_ABLE_COMMON, SELECTCOM
SIF RESULT == 0
	RETURN 0
;ウフフ中じゃないと無理
SIF TFLAG:44 == 0
	RETURN 0
;助手がルーミアでないとダメ
;IF NO:PLAYER != 3
;	RETURN 0
;ELSE
;	RETURN 0
;ENDIF
;アイマスク使用中はダメ
SIF TEQUIP:43
	RETURN 0
RETURN 1

@COM172
;暗闇
;アイマスクのコピー
;要求の機能はほとんどCOMABLE.ERBの方で実現している

PRINTL 暗闇
STR:0 = 暗闇

LOSEBASE:体力 += 0
LOSEBASE:気力 += 50

A = 250
SOURCE:露出 = 1000
SOURCE:逸脱 = 500

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES A , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES A , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES A , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES A , 1.10
ELSEIF PALAM:欲情 >= PALAMLV:4
	TIMES A , 1.20
ENDIF

;ABL:従順をみる
IF ABL:親密 == 0
	TIMES A , 0.40
ELSEIF ABL:親密 == 1
	TIMES A , 0.60
ELSEIF ABL:親密 == 2
	TIMES A , 0.80
ELSEIF ABL:親密 == 3
	TIMES A , 1.00
ELSEIF ABL:親密 == 4
	TIMES A , 1.10
ELSE
	A = A * (ABL:親密 * 5 + 95) / 100
	TIMES A , 1.20
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES A , 0.80
ELSEIF ABL:マゾっ気 == 1
	TIMES A , 1.00
ELSEIF ABL:マゾっ気 == 2
	TIMES A , 1.30
ELSEIF ABL:マゾっ気 == 3
	TIMES A , 1.60
ELSEIF ABL:マゾっ気 == 4
	TIMES A , 2.00
ELSE
	A = A * (ABL:マゾっ気 * 50 + 50) / 100
ENDIF

;倒錯的
SIF TALENT:倒錯的
	TIMES A , 2.00
;臆病
SIF TALENT:臆病
	TIMES SOURCE:逸脱 , 2.00

CALL TRAIN_MESSAGE_B

;アイマスクの着脱
IF TEQUIP:80
	TEQUIP:80 = 0
ELSE
	TEQUIP:80 = 1
ENDIF

RETURN 1

@TRAIN_MESSAGE_COM172
;アイマスクの着脱
IF TEQUIP:80
	PRINTFORML %CALLNAME:ASSI%が能力を解除した
ELSE
	PRINTFORML %CALLNAME:ASSI%が能力を展開し、辺りは闇に包まれた
ENDIF

@EQUIP_COM151
;暗闇

PRINTL ＜暗闇展開中＞

LOSEBASE:体力 += 0
LOSEBASE:気力 += 50

A = 250
B = 1000
C = 500

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES A , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES A , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES A , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES A , 1.10
ELSEIF PALAM:欲情 >= PALAMLV:4
	TIMES A , 1.20
ENDIF

;ABL:従順をみる
IF ABL:親密 == 0
	TIMES A , 0.40
ELSEIF ABL:親密 == 1
	TIMES A , 0.60
ELSEIF ABL:親密 == 2
	TIMES A , 0.80
ELSEIF ABL:親密 == 3
	TIMES A , 1.00
ELSEIF ABL:親密 == 4
	TIMES A , 1.10
ELSE
	A = A * (ABL:親密 * 5 + 95) / 100
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES A , 0.80
ELSEIF ABL:マゾっ気 == 1
	TIMES A , 1.00
ELSEIF ABL:マゾっ気 == 2
	TIMES A , 1.30
ELSEIF ABL:マゾっ気 == 3
	TIMES A , 1.60
ELSEIF ABL:マゾっ気 == 4
	TIMES A , 2.00
ELSE
	A = A * (ABL:マゾっ気 * 50 + 50) / 100
ENDIF

;倒錯的
SIF TALENT:倒錯的
	TIMES A , 2.00
;臆病
SIF TALENT:臆病
	TIMES C , 2.00


SOURCE:液体追加 += A
SOURCE:露出 += B
SOURCE:逸脱 += C

UP:欲情 += A
UP:恐怖 += SOURCE:逸脱


IF TALENT:オトコ == 0 && TALENT:PLAYER:オトコ == 0
	PRINTS EXPNAME:40
	PRINTL +1
	EXP:レズ経験 += 1
ELSEIF TALENT:オトコ == 1 && TALENT:PLAYER:オトコ == 1
	PRINTS EXPNAME:41
	PRINTL +1
	EXP:ＢＬ経験 += 1
ENDIF

RETURN 1
