@COM_ABLE256
;挿入子宮口責め実行判定
;COM_ABLE共通判定
CALL COM_ABLE_COMMON, SELECTCOM
SIF RESULT == 0
	RETURN 0
;正常位実行判定流用
;ウフフ中じゃないと無理
SIF TFLAG:44 == 0
	RETURN 0
;バイブ挿入中はダメ
SIF TEQUIP:11
	RETURN 0
;クスコ挿入中はダメ
SIF TEQUIP:61
	RETURN 0
;焼芋入中は不可
SIF TEQUIP:71
	RETURN 0
;オトコだとダメ
SIF TALENT:122
	RETURN 0
;小人体型持ちは、双方が調教者と調教対象ならOK
;それ以外の場合は主人が禁断の知識持ちじゃないとダメ
SIF TALENT:149 && (TALENT:MASTER:125 == 0 && TALENT:PLAYER:149 == 0)
	RETURN 0
;調教者がオトコ、半人半妖、ふたなり、もしくはペニスバンドがないとダメ
SIF TALENT:PLAYER:119 == 0 && TALENT:PLAYER:121 == 0 && TALENT:PLAYER:122 == 0 && ITEM:PBAND == 0
	RETURN 0
;処女で、従順4以下・レズっ気4以下のASSIの場合正常位はできない（サドならＯＫ）
IF EXP:0 == 0 && ASSIPLAY
	SIF (ABL:ASSI:0 <= 4 || ABL:ASSI:9 <= 4) && TALENT:ASSI:83 == 0
		RETURN 0
ENDIF
;潤滑不足で、従順3以下・レズっ気3以下のASSIの場合正常位はできない（サドならＯＫ）
IF PALAM:3 < PALAMLV:2 && ASSIPLAY
	SIF (ABL:ASSI:0 <= 3 || ABL:ASSI:9 <= 3) && TALENT:ASSI:83 == 0
		RETURN 0
ENDIF
;触手調教中はダメ
SIF TEQUIP:90
	RETURN 0
;お風呂場プレイ中はプレイマットが無いとダメ
IF TEQUIP:58
	SIF ITEM:13 == 0 && NOITEM == 0
		RETURN 0
ENDIF
;前回コマンドが正常位・後背位・対面座位・背面座位・騎乗位・乱れ牡丹・挿入Ｇスポ責め・挿入子宮口責めでないとダメ
SIF PREVCOM != 20 && PREVCOM != 21 && PREVCOM != 24 && PREVCOM != 25 && PREVCOM != 34 && PREVCOM != 88 && PREVCOM != 255 && PREVCOM != 256
	RETURN 0
;調教者の技巧3以上かつ前回コマンド実行者が今回も実行していないとダメ
IF ABL:PLAYER:2 > 2 && ((ASSIPLAY && TFLAG:50) || (ASSIPLAY == 0 && TFLAG:50 == 0))
	RETURN 1
ELSE
	RETURN 0
ENDIF
RETURN 1

@COM256
;挿入子宮口責め

TFLAG:42 = 0
IF SELECTCOM == 34
	PRINTL 騎乗子宮口責め
	STR:0 = 騎乗子宮口責め
ELSE
	PRINTL 挿入子宮口責め
	STR:0 = 挿入子宮口責め
ENDIF

;派生元コマンドをPREVCOMに登録、SELECTCOMをこのコマンド番号に変更してからCALL TRAIN_MESSAGE_B
SIF SELECTCOM != 256
	PREVCOM = SELECTCOM
SELECTCOM = 256

CALL TRAIN_MESSAGE_B

;V経験を伴うコマンドのフラグ(処女膜再生対応)
TFLAG:19 = 1
SIF TALENT:85 && ASSIPLAY == 0 && EXP:0 == 0
	TFLAG:20 = 1

;-------------------------------------------------
;射精ゲージチェック
;-------------------------------------------------
SIF TALENT:PLAYER:121 || TALENT:PLAYER:122
	BASE:PLAYER:2 += CALC_EJAC(SELECTCOM, PLAYER)

;-------------------------------------------------
;ソースの計算
;-------------------------------------------------
IF PREVCOM == 34
	LOSEBASE:0 += 60
	LOSEBASE:1 += 150
	SOURCE:12 = 900
ELSE
	LOSEBASE:0 += 50
	LOSEBASE:1 += 100
	SOURCE:12 = 400
ENDIF

SOURCE:0 = 0

;前方向挿入の場合（正常位・対面座位・騎乗位）
IF PREVCOM == 20 || PREVCOM == 24 || PREVCOM == 34
	;ABL:Ｃ感覚をみる
	IF ABL:3 == 0
		SOURCE:0 = 20
	ELSEIF ABL:3 == 1
		SOURCE:0 = 100
	ELSEIF ABL:3 == 2
		SOURCE:0 = 400
	ELSEIF ABL:3 == 3
		SOURCE:0 = 900
	ELSEIF ABL:3 == 4
		SOURCE:0 = 1400
	ELSE
		SOURCE:0 = 100 + (ABL:3 * 400)
	ENDIF
ENDIF

;ABL:Ｖ感覚をみる
IF ABL:4 == 0
	SOURCE:1 = 10
	SOURCE:3 = 100
ELSEIF ABL:4 == 1
	SOURCE:1 = 30
	SOURCE:3 = 180
ELSEIF ABL:4 == 2
	SOURCE:1 = 400
	SOURCE:3 = 250
ELSEIF ABL:4 == 3
	SOURCE:1 = 800
	SOURCE:3 = 380
ELSEIF ABL:4 == 4
	SOURCE:1 = 2700
	SOURCE:3 = 500
ELSE
	SOURCE:1 = 300 + (ABL:4 * 700)
	SOURCE:3 = 200 + (ABL:4 * 120)
ENDIF

;EXP:Ｖ経験をみる
IF EXP:0 < EXPLV:1
	TIMES SOURCE:1 , 0.20
	SOURCE:6 = 300
ELSEIF EXP:0 < EXPLV:2
	TIMES SOURCE:1 , 0.60
	SOURCE:6 = 100
ELSEIF EXP:0 < EXPLV:3
	TIMES SOURCE:1 , 1.00
	SOURCE:6 = 10
ELSEIF EXP:0 < EXPLV:4
	TIMES SOURCE:1 , 1.20
	SOURCE:6 = 0
ELSEIF EXP:0 < EXPLV:5
	TIMES SOURCE:1 , 1.30
	SOURCE:6 = 0
ELSE
	TIMES SOURCE:1 , 1.80
	SOURCE:6 = 0
ENDIF

;PALAM:潤滑をみる
IF PALAM:3 < PALAMLV:1
	TIMES SOURCE:0 , 0.50
	TIMES SOURCE:1 , 0.10
	SOURCE:6 += 1000
	TIMES SOURCE:6 , 3.00
ELSEIF PALAM:3 < PALAMLV:2
	TIMES SOURCE:0 , 0.60
	TIMES SOURCE:1 , 0.40
	SOURCE:6 += 300
	TIMES SOURCE:6 , 1.00
ELSEIF PALAM:3 < PALAMLV:3
	TIMES SOURCE:1 , 1.00
	TIMES SOURCE:6 , 0.50
ELSEIF PALAM:3 < PALAMLV:4
	TIMES SOURCE:1 , 1.40
	TIMES SOURCE:6 , 0.20
ELSEIF PALAM:3 >= PALAMLV:4
	TIMES SOURCE:1 , 1.80
	TIMES SOURCE:6 , 0.10
ENDIF

;対面座位だと効果が高い
IF PREVCOM == 24
	TIMES SOURCE:1 , 1.30
	TIMES SOURCE:3 , 1.10
ENDIF

;背面座位だと効果が低い
IF PREVCOM == 25 || PREVCOM == 88
	TIMES SOURCE:1 , 0.70
	TIMES SOURCE:3 , 0.90
ENDIF

;調教者がふたなり
IF ASSIPLAY
	SIF TALENT:ASSI:121
		TIMES SOURCE:1 , 2.50
ENDIF

;小柄体形
SIF TALENT:100
	TIMES SOURCE:6 , 2.00

;貞操観念
IF TALENT:30
	IF EXP:0 == 0
		TIMES SOURCE:3 , 0.60
		TIMES SOURCE:14, 5.00
		SOURCE:15 = 2000
	ELSE
		TIMES SOURCE:3 , 0.60
		SOURCE:15 = 1000
	ENDIF
;貞操無頓着
ELSEIF TALENT:31
	IF EXP:0 == 0
		TIMES SOURCE:3 , 0.60
		SOURCE:15 = 300
	ENDIF
ELSE
	IF EXP:0 == 0
		SOURCE:15 = 3000
	ENDIF
ENDIF

;PALAM:欲情をみる
IF PALAM:5 < PALAMLV:1
	TIMES SOURCE:0 , 0.60
	TIMES SOURCE:1 , 0.60
	TIMES SOURCE:3 , 0.30
ELSEIF PALAM:5 < PALAMLV:2
	TIMES SOURCE:0 , 0.80
	TIMES SOURCE:1 , 0.80
	TIMES SOURCE:3 , 0.60
ELSEIF PALAM:5 < PALAMLV:3
	TIMES SOURCE:0 , 1.00
	TIMES SOURCE:1 , 1.00
	TIMES SOURCE:3 , 1.00
ELSEIF PALAM:5 < PALAMLV:4
	TIMES SOURCE:0 , 1.20
	TIMES SOURCE:1 , 1.20
	TIMES SOURCE:3 , 1.50
ELSEIF PALAM:5 >= PALAMLV:4
	TIMES SOURCE:0 , 1.50
	TIMES SOURCE:1 , 1.50
	TIMES SOURCE:3 , 1.80
ENDIF

;ABL:従順をみる
IF ABL:0 == 0
	TIMES SOURCE:0 , 0.50
	TIMES SOURCE:1 , 0.50
	TIMES SOURCE:3 , 0.60
	TIMES SOURCE:15 , 2.00
ELSEIF ABL:0 == 1
	TIMES SOURCE:0 , 0.80
	TIMES SOURCE:1 , 0.80
	TIMES SOURCE:3 , 0.80
	TIMES SOURCE:15 , 1.50
ELSEIF ABL:0 == 2
	TIMES SOURCE:0 , 1.00
	TIMES SOURCE:1 , 1.00
	TIMES SOURCE:3 , 1.00
	TIMES SOURCE:15 , 1.00
ELSEIF ABL:0 == 3
	TIMES SOURCE:0 , 1.20
	TIMES SOURCE:1 , 1.30
	TIMES SOURCE:3 , 1.20
	TIMES SOURCE:15 , 0.80
ELSEIF ABL:0 == 4
	TIMES SOURCE:0 , 1.40
	TIMES SOURCE:1 , 1.60
	TIMES SOURCE:3 , 1.40
	TIMES SOURCE:15 , 0.60
ELSE
	SOURCE:0 = SOURCE:0 * (ABL:0 * 10 + 110) / 100
	SOURCE:1 = SOURCE:1 * (ABL:0 * 20 + 100) / 100
	SOURCE:3 = SOURCE:3 * (ABL:0 * 10 + 110) / 100
	TIMES SOURCE:15 , 0.30
ENDIF

IF PREVCOM == 34
	;ABL:奉仕精神をみる
	IF ABL:6 == 0
		SOURCE:4 = 200
		SOURCE:5 = 50
		SOURCE:14 = 300
	ELSEIF ABL:6 == 1
		SOURCE:4 = 250
		SOURCE:5 = 200
		SOURCE:14 = 100
	ELSEIF ABL:6 == 2
		SOURCE:4 = 350
		SOURCE:5 = 550
		SOURCE:14 = 30
	ELSEIF ABL:6 == 3
		SOURCE:4 = 450
		SOURCE:5 = 900
		SOURCE:14 = 0
	ELSEIF ABL:6 == 4
		SOURCE:4 = 600
		SOURCE:5 = 1500
		SOURCE:14 = 0
	ELSE
		SOURCE:4 = 375 + (ABL:6 * 75)
		SOURCE:5 = 450 + (ABL:6 * 350)
		SOURCE:14 = 0
	ENDIF
	;ABL:技巧をみる
	IF ABL:2 == 0
		TIMES SOURCE:1 , 0.30
		TIMES SOURCE:3 , 0.30
	ELSEIF ABL:2 == 1
		TIMES SOURCE:1 , 0.60
		TIMES SOURCE:3 , 0.60
	ELSEIF ABL:2 == 2
		TIMES SOURCE:1 , 1.00
		TIMES SOURCE:3 , 1.00
	ELSEIF ABL:2 == 3
		TIMES SOURCE:1 , 1.10
		TIMES SOURCE:3 , 1.10
	ELSEIF ABL:2 == 4
		TIMES SOURCE:1 , 1.30
		TIMES SOURCE:3 , 1.20
	ELSE
	SOURCE:1 = SOURCE:1 * (ABL:2 * 100 + 100) / 100
	SOURCE:3 = SOURCE:3 * (ABL:2 * 10 + 90) / 100
	ENDIF
ENDIF

;好感度ランダム変化
A = RAND:12 + 8
SIF TALENT:85 || TALENT:153
	A += 5
SIF TALENT:88
	A += 5
;合意がないと好感度が下がる
IF TALENT:152 == 0 && TFLAG:48 == 0
	A -= 15
	SOURCE:15 += 1200
ENDIF
TFLAG:30 += A
TFLAG:37 += A / 2

EXP:0 += 1
PRINTL Ｖ経験＋1

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK

;射精時の処理
IF E >= 1
	;コマンドごとに固有の処理はこの下に書く
	IF ABL:0 >= 3 && ABL:1 >= 3 && FLAG:6 && TEQUIP:PLAYER:85 != 1
	PRINTFORML %CALLNAME:TARGET%の子宮に熱い精液が注ぎ込まれていった…
	PRINTFORML 
	ENDIF

	;射精先タイプの設定
	TFLAG:703 = 1
	;射精先選択の可・不可
	TFLAG:704 = 0
	;汎用的な処理はこの関数で行う
	;（射精ゲージの再計算や射精経験の上昇と共通部分の表示）
	CALL SAMEN_SHOOT
ENDIF

;射精に関係なく行われる処理はここから
;奴隷のＶ⇔調教者のＰの汚れが移動
STAIN:3 |= STAIN:PLAYER:2
STAIN:PLAYER:2 |= STAIN:3

IF TALENT:122 == 0 && TALENT:PLAYER:122 == 0
	PRINTFORML %EXPNAME:40%＋4
	EXP:40 += 4
ENDIF

;IF ASSIPLAY == 0
;	IF ABL:4 >= 3
;		TFLAG:30 += 2
;	ELSE
;		TFLAG:30 += 1
;	ENDIF
;ENDIF

RETURN 1

@TRAIN_MESSAGE_COM256
;騎乗位
IF PREVCOM == 34
	PRINTFORMW %CALLNAME:TARGET%は%CALLNAME:PLAYER%の胸に手を衝き、ペニスを根元まで飲み込んだ…
	IF EXP:0 <= 30
		PRINTFORMW %CALLNAME:TARGET%はそのまま腰を前後に揺すっている…
	ELSEIF EXP:0 >= 31 && EXP:0 <= 50 && TALENT:121
		PRINTFORMW %CALLNAME:TARGET%は%CALLNAME:PLAYER%の腹にペニスを押し付けている…
	ELSEIF EXP:0 >= 31 && EXP:0 <= 50
		PRINTFORMW %CALLNAME:TARGET%は%CALLNAME:PLAYER%の陰毛でクリトリスを刺激しているようだ…
	ELSEIF EXP:0 >= 51 && EXP:0 <= 80
		PRINTFORMW %CALLNAME:TARGET%は腰をくねらせ、挿入感を愉しんでは熱い息を吐いている…
	ELSEIF EXP:0 >= 81 && EXP:0 <= 120
		PRINTFORML %CALLNAME:TARGET%はクン、クンと腰を沈ませ、深奥を突く感触に酔っている…
		PRINTFORMW コリコリした子宮口は綻び、法悦とともに仔を孕む用意を始めている…
	ELSEIF EXP:0 >= 121
		PRINTFORML %CALLNAME:TARGET%はリズミカルに腰を小さく縦に揺すり、牝そのものの顔で涎を垂らしている…
		PRINTFORMW 子作りの快楽に理性は蕩け、牝の肉体は子種を求めて貪欲にひくついている…
	ENDIF
ELSE
	;正常位
	SIF PREVCOM == 20
		PRINTFORMW 腰を掴んで深く突き、%CALLNAME:TARGET%の子宮をコツンと叩いた…
	;後背位
	SIF PREVCOM == 21
		PRINTFORMW 尻を掴んで深く突き、%CALLNAME:TARGET%の子宮をコツンと叩いた…
	;対面座位
	SIF PREVCOM == 24
		PRINTFORMW 腰の括れを深く抱いて、%CALLNAME:TARGET%の子宮をグリグリと刺激した…
	;背面座位・乱れ牡丹
	SIF PREVCOM == 25 || PREVCOM == 88
		PRINTFORMW 腰を前に押すようにして、%CALLNAME:TARGET%の深奥まで突き上げた…
	IF EXP:0 <= 30 || (EXP:0 >= 31 && EXP:0 <= 50 && (PREVCOM == 21 || PREVCOM == 25 || PREVCOM == 88))
		PRINTFORMW %CALLNAME:TARGET%は異物感が強いのか、苦しそうにしている…
	ELSEIF EXP:0 >= 31 && EXP:0 <= 50 && TALENT:121
		PRINTFORMW %CALLNAME:TARGET%は陰毛と臍の窪みにペニスを嬲られ、鼻声を漏らしている…
	ELSEIF EXP:0 >= 31 && EXP:0 <= 50
		PRINTFORMW %CALLNAME:TARGET%は陰毛にクリトリスを擦られ、鼻声を漏らしている…
	ELSEIF EXP:0 >= 51 && EXP:0 <= 80
		PRINTFORMW %CALLNAME:TARGET%は長く甘い息を吐きながら、挿入感を噛み締めている…
	ELSEIF EXP:0 >= 81 && EXP:0 <= 120
		PRINTFORML 子宮が子種を受ける準備を済ませたらしく、先端のくびれが膣奥の窪みで引っかかる…
		PRINTFORMW %CALLNAME:TARGET%の子宮をノックする度、口をパクパクさせて激しく震えている…
	ELSEIF EXP:0 >= 121
		PRINTFORML 低い位置に下りてきた%CALLNAME:TARGET%の子宮を突いて揺すってやると、
		PRINTFORMW %CALLNAME:TARGET%は狂ったように悶え、牝として最高の快楽に溺れた…
	ENDIF
ENDIF

