@COM_ABLE166
;角愛撫実行判定
;COM_ABLE共通判定
CALL COM_ABLE_COMMON, SELECTCOM
SIF RESULT == 0
	RETURN 0
;ウフフ中じゃないと無理
SIF TFLAG:44 == 0
	RETURN 0
;調教対象に角がないとダメ
SIF TALENT:214 == 0
	RETURN 0
;触手調教中はダメ
SIF TEQUIP:90
	RETURN 0
;caved!!!!が発動しているとダメ
SIF TFLAG:69 > 0
	RETURN 0
RETURN 1

@COM166
;角愛撫

;調教対象が緊縛していない反発感情3のキモけーねだった場合、逆襲される可能性大
IF NAME_CSV(NO:TARGET, 0) == "慧音" && TEQUIP:1 && MARK:3 >= 3 && TEQUIP:44 == 0
	IF RAND:4 > 0 && TFLAG:69 == 0
		TFLAG:69 = 1
		JUMP CAVED
	ENDIF
ENDIF

PRINTL 角愛撫
STR:0 = 角愛撫
CALL TRAIN_MESSAGE_B

LOSEBASE:0 += 15
LOSEBASE:1 += 80

SOURCE:14 = 400

;ABL:欲望をみる
IF ABL:欲望 == 0
	SOURCE:7 = 50
	SOURCE:13 = 50
ELSEIF ABL:欲望 == 1
	SOURCE:7 = 100
	SOURCE:13 = 100
ELSEIF ABL:欲望 == 2
	SOURCE:7 = 250
	SOURCE:13 = 200
ELSEIF ABL:欲望 == 3
	SOURCE:7 = 500
	SOURCE:13 = 400
ELSEIF ABL:欲望 == 4
	SOURCE:7 = 1000
	SOURCE:13 = 800
ELSE
	SOURCE:7 = 2000
	SOURCE:13 = 1600
ENDIF

;ABL:露出癖をみる
IF ABL:露出癖 == 0
	SOURCE:12 = 50
ELSEIF ABL:露出癖 == 1
	SOURCE:12 = 100
ELSEIF ABL:露出癖 == 2
	SOURCE:12 = 200
ELSEIF ABL:露出癖 == 3
	SOURCE:12 = 600
ELSEIF ABL:露出癖 == 4
	SOURCE:12 = 1000
ELSE
	SOURCE:12 = 1500
ENDIF

IF STAIN:PLAYER:0
;主人の口の汚れがあると不潔追加
	SOURCE:8 = 300
	;汚臭鈍感
	SIF TALENT:61
		SOURCE:8 /= 4
	;汚臭敏感
	SIF TALENT:62
		SOURCE:8 *= 3
ENDIF

IF TALENT:122 == 0 && TALENT:PLAYER:122 == 0
	PRINTS EXPNAME:40
	PRINTL +5
	EXP:40 += 5
ELSEIF TALENT:122 == 1 && TALENT:PLAYER:122 == 1
	PRINTS EXPNAME:41
	PRINTL +5
	EXP:41 += 5
ENDIF

RETURN 1

@TRAIN_MESSAGE_COM166
PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%の角をキスしたり、撫でまわし始めた
PRINTFORML %CALLNAME:TARGET%は角に与えられる刺激に困惑した表情を浮かべている……

