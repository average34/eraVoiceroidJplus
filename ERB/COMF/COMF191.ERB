@COM_ABLE191
;手淫する実行判定
;COM_ABLE共通判定
CALL COM_ABLE_COMMON, SELECTCOM
SIF RESULT == 0
	RETURN 0
;ウフフ中じゃないと無理
SIF TFLAG:44 == 0
	RETURN 0
;オトコかふたなりじゃないとダメ
SIF (TALENT:121 || TALENT:122) == 0
	RETURN 0
RETURN 1

@COM191
;手淫する

PRINTL 手淫する
STR:0 = 手淫する
CALL TRAIN_MESSAGE_B

;-------------------------------------------------
;実行決定
;-------------------------------------------------
;-------------------------------------------------
;ソースの計算
;-------------------------------------------------
LOSEBASE:0 += 10
LOSEBASE:1 += 100

SOURCE:3  = 500
SOURCE:11  = 800
SOURCE:12  = 600


;ABL:Ｃ感覚をみる
IF ABL:3 == 0
	SOURCE:0 = 60
	SOURCE:7 = 60
ELSEIF ABL:3 == 1
	SOURCE:0 = 180
	SOURCE:7 = 180
ELSEIF ABL:3 == 2
	SOURCE:0 = 800
	SOURCE:7 = 800
ELSEIF ABL:3 == 3
	SOURCE:0 = 1700
	SOURCE:7 = 1700
ELSEIF ABL:3 == 4
	SOURCE:0 = 2700
	SOURCE:7 = 2700
ELSE
	SOURCE:0 = 800 + ABL:3 * 600
	SOURCE:7 = 3800
ENDIF

;ABL:マゾっ気をみる
IF ABL:8 == 0
	SOURCE:5 = 130
ELSEIF ABL:8 == 1
	SOURCE:5 = 250
ELSEIF ABL:8 == 2
	SOURCE:5 = 500
ELSEIF ABL:8 == 3
	SOURCE:5 = 800
ELSEIF ABL:8 == 4
	SOURCE:5 = 1400
ELSE
	SOURCE:5 = ABL:8 * 600 - 1000
ENDIF

;プレイヤーのABL:技巧をみる
IF ABL:PLAYER:2 == 0
	TIMES SOURCE:0 , 0.50
	TIMES SOURCE:7 , 0.50
ELSEIF ABL:PLAYER:2 == 1
	TIMES SOURCE:0 , 0.80
	TIMES SOURCE:7 , 0.80
ELSEIF ABL:PLAYER:2 == 2
	TIMES SOURCE:0 , 1.00
	TIMES SOURCE:7 , 1.00
ELSEIF ABL:PLAYER:2 == 3
	TIMES SOURCE:0 , 1.20
	TIMES SOURCE:7 , 1.50
ELSEIF ABL:PLAYER:2 == 4
	TIMES SOURCE:0 , 1.50
	TIMES SOURCE:7 , 2.50
ELSE
	SOURCE:0 = SOURCE:0 * (ABL:PLAYER:2 * 75 + 25) / 200
	SOURCE:7 = SOURCE:7 * (ABL:PLAYER:2 * 75 + 25) / 100
ENDIF

;ABL:奉仕精神をみる
IF ABL:PLAYER:6 == 0
	TIMES SOURCE:3 , 0.60
;	TIMES SOURCE:7 , 0.60
ELSEIF ABL:PLAYER:6 == 1
	TIMES SOURCE:3 , 0.80
;	TIMES SOURCE:7 , 0.80
ELSEIF ABL:PLAYER:6 == 2
	TIMES SOURCE:3 , 1.00
;	TIMES SOURCE:7 , 1.00
ELSEIF ABL:PLAYER:6 == 3
	TIMES SOURCE:3 , 1.20
;	TIMES SOURCE:7 , 1.50
ELSEIF ABL:PLAYER:6 == 4
	TIMES SOURCE:3 , 1.50
;	TIMES SOURCE:7 , 2.50
ELSE
	SOURCE:3 = SOURCE:3 * (ABL:PLAYER:2 * 75 + 25) / 200
;	SOURCE:7 = SOURCE:7 * (ABL:PLAYER:2 * 75 + 25) / 100
ENDIF

;調教者の指⇔奴隷のＰの汚れが移動
IF TALENT:TARGET:119 || TALENT:TARGET:122  || TALENT:TARGET:121
	STAIN:PLAYER:2 |= STAIN:1
	STAIN:2 |= STAIN:PLAYER:1
;奴隷の指⇔調教者のＶの汚れが移動
ELSE
	STAIN:PLAYER:3 |= STAIN:2
	STAIN:3 |= STAIN:PLAYER:2
ENDIF

IF TALENT:122 == 0 && TALENT:PLAYER:122 == 0
	PRINTS EXPNAME:40
	PRINTL +1
	EXP:40 += 1
	EXP:PLAYER:40 += 1
ELSEIF TALENT:122 == 1 && TALENT:PLAYER:122 == 1
	PRINTS EXPNAME:41
	PRINTL +1
	EXP:41 += 1
	EXP:PLAYER:41 += 1
ENDIF

;主導権をチェック
IF TFLAG:45 == 0
	;主導権が主人公側
	;ABL:従順をみる
	IF ABL:0 <= 1
		SOURCE:21 += 300 + (ABL:0 * 50)
	ELSEIF ABL:0 <= 3
		SOURCE:21 += 600 + (ABL:0 * 100)
	ELSEIF ABL:0 <= 5
		SOURCE:21 += 800 + (ABL:0 * 120)
	ELSEIF ABL:0 <= 8
		SOURCE:21 += 1000 + (ABL:0 * 140)
	ELSEIF ABL:0 <= 11
		SOURCE:21 += 1200 + (ABL:0 * 160)
	ELSE
		SOURCE:21 += 1500 + (ABL:0 * 180)
	ENDIF
ELSE
	;主導権が相手側
	;ABL:サドっ気をみる
	IF ABL:15 == 0
		SOURCE:20 = 600
	ELSEIF ABL:15 == 1
		SOURCE:20 = 900
	ELSEIF ABL:15 == 2
		SOURCE:20 = 1200
	ELSEIF ABL:15 == 3
		SOURCE:20 = 1600
	ELSEIF ABL:15 == 4
		SOURCE:20 = 2000
	ELSE
		SOURCE:20 = 1000 + (ABL:15 * 300)
	ENDIF
ENDIF

;好感度ランダム変化
A = RAND:10 + 5
;合意がないと好感度が下がる
IF TALENT:152 == 0 && TFLAG:48 == 0
	A -= 9
	SOURCE:15 += 400
ENDIF
TFLAG:30 += A
TFLAG:37 += A / 2

;TFLAG:100 = 0

;調教者がふたなり
IF TALENT:PLAYER:121
	SOURCE:13 /= 2
ENDIF

RETURN 1

;手淫する
@TRAIN_MESSAGE_COM191
PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:TARGET%のペニスを手で扱いている…
