@COM_ABLE371
;オムツ実行判定
;COM_ABLE共通判定
CALL COM_ABLE_COMMON, SELECTCOM
SIF RESULT == 0
	RETURN 0
;ウフフ中は無理
SIF TFLAG:44 == 1
	RETURN 0
;おもらし癖が無ければ不可
SIF TALENT:57 == 0
	RETURN 0
;霧の湖デート中は無理
SIF TEQUIP:2 == 3
	RETURN 0
;温泉デート中は無理
SIF TEQUIP:2 == 7
	RETURN 0
;海デート中は無理
SIF TEQUIP:2 == 14
	RETURN 0
;異常経験フィルタ
SIF (FLAG:61 & 1) == 0
	RETURN 0
;解除はいつでも可能
SIF TEQUIP:20
	RETURN 1
;アイテムを持っているか、アイテムなし設定でないとダメ
SIF ITEM:35 == 0 && NOITEM == 0
	RETURN 0
RETURN 1

@COM371

;-------------------------------------------------
;実行できるかの判定
;-------------------------------------------------
;失敗することはない
;-------------------------------------------------
;実行決定
;-------------------------------------------------
;オムツ
IF TEQUIP:20
	PRINTL オムツを脱がす
	STR:0 = オムツを脱がす
ELSE
	PRINTL オムツを履かせる
	STR:0 = オムツを履かせる
ENDIF

CALL TRAIN_MESSAGE_B

LOSEBASE:0 += 0
;素質による気力消費変化
IF TALENT:35
	;恥じらい
	LOSEBASE:1 += 150
ELSEIF TALENT:36
	;恥薄い
	LOSEBASE:1 += 50
ELSE
	LOSEBASE:1 += 100
ENDIF

;オムツの着脱
IF TEQUIP:20
	TEQUIP:20 = 0
ELSE
	TEQUIP:20 = 1
	ITEM:35 -= 1
ENDIF

;ソース
;露出癖をみる（露出、屈従、逸脱のソース）
IF ABL:7 == 0
	SOURCE:12 = 6000
	SOURCE:13 = 6000
	SOURCE:14 = 2000
ELSEIF ABL:7 == 1
	SOURCE:12 = 5000
	SOURCE:13 = 5000
	SOURCE:14 = 1000
ELSEIF ABL:7 == 2
	SOURCE:12 = 4000
	SOURCE:13 = 4000
	SOURCE:14 = 500
ELSEIF ABL:7 == 3
	SOURCE:12 = 3000
	SOURCE:13 = 3000
	SOURCE:14 = 100
ELSEIF ABL:7 == 4
	SOURCE:12 = 2000
	SOURCE:13 = 2000
	SOURCE:14 = 50
ELSE
	SOURCE:12 = 1000
	SOURCE:13 = 1000
	SOURCE:14 = 10
ENDIF

;マゾっ気をみる（露出、欲情追加、液体追加のソース）
;マゾッ気Lv3以下の場合、液体追加のソースは夏のみ（蒸れる）
IF ABL:21 == 0
	TIMES SOURCE:12 , 0.80
	SOURCE:11 = 100
	IF DAY:2 == 1
		SOURCE:10 = 100
	ENDIF
ELSEIF ABL:21 == 1
	TIMES SOURCE:12 , 1.00
	SOURCE:11 = 200
	IF DAY:2 == 1
		SOURCE:10 = 300
	ENDIF
ELSEIF ABL:21 == 2
	TIMES SOURCE:12 , 1.20
	SOURCE:11 = 400
	IF DAY:2 == 1
		SOURCE:10 = 700
	ENDIF
ELSEIF ABL:21 == 3
	TIMES SOURCE:12 , 1.40
	SOURCE:11 = 700
	IF DAY:2 != 1
		SOURCE:10 = 1200
	ENDIF
ELSEIF ABL:21 == 4
	TIMES SOURCE:12 , 1.50
	SOURCE:11 = 1100
	SOURCE:10 = 1800
ELSE
	TIMES SOURCE:12 , 1.70
	SOURCE:11 = 1500
	SOURCE:10 = 2500
ENDIF

;
LOCAL:1 = 50
;EXP:愛情経験をみる
IF EXP:23 < EXPLV:1
	TIMES LOCAL:1 , 3.00
ELSEIF EXP:23 < EXPLV:2
	TIMES LOCAL:1 , 2.50
ELSEIF EXP:23 < EXPLV:3
	TIMES LOCAL:1 , 2.00
ELSEIF EXP:23 < EXPLV:4
	TIMES LOCAL:1 , 1.00
ELSEIF EXP:23 < EXPLV:5
	TIMES LOCAL:1 , 0.80
ELSE
	TIMES LOCAL:1 , 0.60
ENDIF

;反抗的
SIF TALENT:11
	TIMES LOCAL:1 , 2.00
;プライド高い
IF TALENT:15
	TIMES LOCAL:1 , 2.00
;プライド低い
ELSEIF TALENT:17
	TIMES LOCAL:1 , 0.80
ENDIF
;感情乏しい
SIF TALENT:22
	TIMES LOCAL:1 , 0.60
;目立ちたがり
SIF TALENT:28
	TIMES LOCAL:1 , 0.80
;抑圧
SIF TALENT:32
	TIMES LOCAL:1 , 3.00
;抵抗
SIF TALENT:34
	TIMES LOCAL:1 , 3.00
;恥じらい
IF TALENT:35
	TIMES LOCAL:1 , 3.50
;恥薄い
ELSEIF TALENT:36
	TIMES LOCAL:1 , 0.50
ENDIF
;幼児、幼稚
SIF TALENT:131 || TALENT:132
	TIMES LOCAL:1 , 0.50
;臆病
SIF TALENT:10
	TIMES LOCAL:1 , 1.20

;逸脱
SOURCE:14 += LOCAL:1 * 5
;反感追加（反抗的、プライド高いのみ）
IF TALENT:11 || TALENT:15
	SOURCE:15 += LOCAL:1 * 2
ENDIF

RETURN 1

@TRAIN_MESSAGE_COM371
;オムツの着脱
IF TEQUIP:20
	PRINTFORML %CALLNAME:TARGET%に履かせていたオムツを取り外した。
	PRINTFORM 中は汗
	IF TEQUIP:20 == 2
		PRINT と尿
	ENDIF
	IF PALAM:3 >= PALAMLV:2
		PRINT と
		SIF PALAM:3 >= PALAMLV:4
			PRINT 大量の
		PRINT 愛液
	ENDIF
	PRINT で蒸れ、オムツを広げると
	IF PALAM:3 >= PALAMLV:4
		IF TEQUIP:2 == 0
			PRINTL 部屋中にその淫靡な香りが充満した…
		ELSE
			PRINTL その淫靡な香りが漂った…
		ENDIF
	ELSE
		IF TEQUIP:20 == 2
			PRINTFORML その匂いが%CALLNAME:MASTER%の鼻をついた…
		ELSE
			PRINTFORML かすかにその匂いが%CALLNAME:MASTER%の鼻をついた…
		ENDIF
	ENDIF

ELSE
	PRINTFORM %CALLNAME:TARGET%に
	IF TALENT:149
		PRINT 人形用の
	ELSEIF TALENT:100
		PRINT 子供用の
	ELSE
		PRINT 大人用の
	ENDIF
	PRINTL オムツを履かせた…
ENDIF

@EQUIP_COM371
;オムツ着用中

PRINTL ＜オムツ着用中＞

LOSEBASE:0 += 0
;素質による気力消費変化
IF TALENT:35
	;恥じらい
	LOSEBASE:1 += 105
ELSEIF TALENT:36
	;恥薄い
	LOSEBASE:1 += 35
ELSE
	LOSEBASE:1 += 70
ENDIF

;ソース
;露出癖をみる
IF ABL:7 == 0
	LOCAL:1 = 3000
	LOCAL:4 = 1000
	LOCAL:5 = 1000
ELSEIF ABL:7 == 1
	LOCAL:1 = 2000
	LOCAL:4 = 500
	LOCAL:5 = 800
ELSEIF ABL:7 == 2
	LOCAL:1 = 1500
	LOCAL:4 = 250
	LOCAL:5 = 600
ELSEIF ABL:7 == 3
	LOCAL:1 = 1000
	LOCAL:4 = 100
	LOCAL:5 = 400
ELSEIF ABL:7 == 4
	LOCAL:1 = 50
	LOCAL:4 = 10
	LOCAL:5 = 200
ELSE
	LOCAL:1 = 100
	LOCAL:4 = 5
	LOCAL:5 = 50
ENDIF

;マゾっ気をみる
IF ABL:8 == 0
	TIMES LOCAL:1 , 0.80
	LOCAL:2 = 50
	LOCAL:3 = 50
ELSEIF ABL:8 == 1
	TIMES LOCAL:1 , 1.00
	LOCAL:2 = 100
	LOCAL:3 = 150
ELSEIF ABL:8 == 2
	TIMES LOCAL:1 , 1.20
	LOCAL:2 = 200
	LOCAL:3 = 350
ELSEIF ABL:8 == 3
	TIMES LOCAL:1 , 1.40
	LOCAL:2 = 350
	LOCAL:3 = 600
ELSEIF ABL:8 == 4
	TIMES LOCAL:1 , 1.50
	LOCAL:2 = 550
	LOCAL:3 = 900
ELSE
	TIMES LOCAL:1 , 1.70
	LOCAL:2 = 750
	LOCAL:3 = 1250
ENDIF

;デート中
IF TEQUIP:2
	TIMES LOCAL:4 , 2.50
ENDIF

LOCAL = 25
;愛情経験をみる
IF EXP:23 < EXPLV:1
	TIMES LOCAL , 3.00
ELSEIF EXP:23 < EXPLV:2
	TIMES LOCAL , 2.50
ELSEIF EXP:23 < EXPLV:3
	TIMES LOCAL , 2.00
ELSEIF EXP:23 < EXPLV:4
	TIMES LOCAL , 1.00
ELSEIF EXP:23 < EXPLV:5
	TIMES LOCAL , 0.80
ELSE
	TIMES LOCAL , 0.60
ENDIF

;反抗的
SIF TALENT:11
	TIMES LOCAL , 2.00
;プライド高い
IF TALENT:15
	TIMES LOCAL , 2.00
;プライド低い
ELSEIF TALENT:17
	TIMES LOCAL , 0.80
ENDIF
;感情乏しい
SIF TALENT:22
	TIMES LOCAL , 0.60
;目立ちたがり
SIF TALENT:28
	TIMES LOCAL , 0.80
;抑圧
SIF TALENT:32
	TIMES LOCAL , 3.00
;抵抗
SIF TALENT:34
	TIMES LOCAL , 3.00
;恥じらい
IF TALENT:35
	TIMES LOCAL , 3.50
;恥薄い
ELSEIF TALENT:36
	TIMES LOCAL , 0.50
ENDIF
;幼児
SIF TALENT:131
	TIMES LOCAL , 0.50
;臆病、幼児、幼稚
SIF TALENT:10 || TALENT:131 || TALENT:132
	TIMES LOCAL , 1.20

;反感追加のソース（反抗的、プライド高いでおもらししてない場合のみ）
IF TALENT:11 || TALENT:15 || TEQUIP:20 != 2
	SOURCE:15 += LOCAL * 2
ENDIF

;不潔のソース（おもらししてる場合のみ、愛撫実行時は倍）
IF  TEQUIP:20 == 2
	IF SELECTCOM == 361
		SOURCE:8 += LOCAL:5 * 2
	ELSE
		SOURCE:8 += LOCAL:5
	ENDIF
ENDIF

LOCAL:4 += LOCAL * 5

;露出のソース
SOURCE:12 += LOCAL:1
;屈従のソース（おもらししてる場合倍）
IF  TEQUIP:20 == 2
	SOURCE:13 += LOCAL:1 * 2
ELSE
	SOURCE:13 += LOCAL:1
ENDIF
;欲情追加のソース
SOURCE:11 += LOCAL:2
;液体追加のソース（夏かマゾッ気Lv4以上の場合のみ）
IF DAY:2 == 1 || ABL:21 >= 4
	SOURCE:10 += LOCAL:3
ENDIF
;逸脱のソース
SOURCE:14 += LOCAL:4

;霧の湖、温泉、海へ行ったら強制解除
IF TEQUIP:2 == 3 || TEQUIP:2 == 7 ||  TEQUIP:2 == 14
	TEQUIP:20 = 0
ENDIF

;異常経験+1
EXP:50 += 1
PRINTFORML %EXPNAME:50%＋１

RETURN 1
