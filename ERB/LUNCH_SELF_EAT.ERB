@LUNCH_SELF_EAT
;主人が自分で弁当を作ってパートナーに食べさせるオプション。
;-------------------------------------------------
;K = 料理の種類
;L = 習得の珠取得量の補正値を決定
;O = 習得の珠増加量
;P = 乱数処理用
;R = 料理の評価
;-------------------------------------------------
K = RAND:16
L = 0
M = 0
N = 0
O = 0
P = 0


L = (ABL:MASTER:技巧 + ABL:MASTER:料理技能 * 2 + 33)

;EXP:調理経験をみる
IF EXP:MASTER:家事経験 < EXPLV:1
	TIMES L , 0.80
ELSEIF EXP:MASTER:家事経験 < EXPLV:2
	TIMES L , 1.00
ELSEIF EXP:MASTER:家事経験 < EXPLV:3
	TIMES L , 1.20
ELSEIF EXP:MASTER:家事経験 < EXPLV:4
	TIMES L , 1.40
ELSEIF EXP:MASTER:家事経験 < EXPLV:5
	TIMES L , 1.70
ELSE
	TIMES L , 2.00
ENDIF

;献身的
SIF TALENT:MASTER:献身的
	TIMES L , 1.20

;料理の種類決定
LOCAL:0 = MASTER
LOCAL:1 = TARGET
TARGET = MASTER
CALL LUNCH_MENU
MASTER = LOCAL:0
TARGET = LOCAL:1

;料理素質で補正を掛けてみる
IF ABL:MASTER:料理素質 == 2
	TIMES L , 1.20
ELSEIF ABL:MASTER:料理素質 == 1
	TIMES L , 1.10
ELSEIF ABL:MASTER:料理素質 == -1
	TIMES L , 0.90
ENDIF

;♂の主人公より下手な事にコンプレックスを感じて効果アップ
;オトコ
SIF TALENT:MASTER:オトコ && ABL:MASTER:料理技能 >= ABL:料理技能
	TIMES L , 1.10

;R = 料理の出来栄え
R = (RAND:100 + ABL:MASTER:料理技能 + 1) / 10
SIF R <= 0
	R = 1
SIF R >= 10
	R = 10

BASE:MASTER:体力 = MAXBASE:MASTER:体力
BASE:MASTER:耐力 = MAXBASE:MASTER:耐力
BASE:TARGET:体力 = MAXBASE:TARGET:体力
BASE:TARGET:耐力 = MAXBASE:TARGET:耐力
IF ASSI > 0
	BASE:ASSI:体力 = MAXBASE:ASSI:体力
	BASE:ASSI:耐力 = MAXBASE:ASSI:耐力
ENDIF

;地の文カット
SIF CFLAG:99 == 1 || FLAG:6 == 0
	GOTO LUNCH_EVALUATE

PRINTL 
PRINTFORMW %CALLNAME:MASTER%は自分で料理を作った
PRINTL 
PRINTW      ･
PRINTW      ･
PRINTW      ･
PRINTW      !
PRINTL 
PRINTFORM %CALLNAME:MASTER%は
IF R <= 2
	PRINT 微妙な
ELSEIF R <= 4
	PRINT 普通の
ELSEIF R <= 6
	PRINT 美味しい
ELSEIF R <= 8
	PRINT 非常に美味しい
ELSEIF R <= 10
	PRINT 最高の味がする
ENDIF
PRINTFORMW %TSTR:1%を作った。
PRINTL      ･
PRINTL      ･
PRINTL      ･
PRINTL 
PRINTL さて……折角の料理だ。
IF ASSI > 0
	PRINTW みんなでいっしょに食べようか……
	WAIT
	PRINTFORML %CALLNAME:MASTER%はみんなで料理を食べることにした。
ELSE
	PRINTFORMW %CALLNAME:TARGET%はよろこんでくれるかな……？
	WAIT
	PRINTFORML %CALLNAME:MASTER%は%CALLNAME:TARGET%といっしょに料理を食べることにした。
ENDIF
PRINTL      ･
PRINTL      ･
PRINTW      ･
PRINT 今回の料理は
IF R >= 10
	PRINTL 会心の出来だ。
	PRINTFORML %CALLNAME:TARGET%は出された料理を食べつくした。
	PRINTFORML あまりにおいしかったのか料理を食べ終えた%CALLNAME:TARGET%はおかわりをねだると
	PRINTFORMW 恥ずかしさからか次の瞬間顔を真っ赤にしてうつむいた。
	SIF RAND:4 == 0
		TFLAG:14 = 1
ELSEIF R >= 8 && R < 10
	PRINTL 我ながらうまい出来だと思う。
	PRINTFORML ふと顔を上げてみると%CALLNAME:TARGET%の皿が空っぽになっていた。
	PRINTFORMW 料理が気に入ったのか%CALLNAME:TARGET%は満足そうな笑みを見せている……
ELSEIF R >= 5 && R < 8
	PRINTL 割といい感じに仕上がっている。
	PRINTFORMW 料理を食べている間、%CALLNAME:TARGET%の口元はずっと綻んでいた。
ELSEIF R >= 3 && R < 5
	PRINTL 普通だ。
	PRINTFORMW %CALLNAME:MASTER%は%CALLNAME:TARGET%と談笑しながら料理を平らげた。
ELSEIF R < 3
	PRINTFORML 残念ながら%CALLNAME:TARGET%の口に合わなかったみたいだ。
	PRINTFORMW %CALLNAME:MASTER%は%CALLNAME:TARGET%の残した料理を食べることにした。
ENDIF
PRINTW      ･
PRINTW      ･
PRINTW      ･
PRINTFORM %CALLNAME:MASTER%と%CALLNAME:TARGET%
IF ASSI > 0
	PRINTFORM と%CALLNAME:ASSI%
ENDIF
PRINTL は英気を養った
PRINTL  
$LUNCH_EVALUATE
;親密でL(恭順・好意の珠取得数)を補正
L = L * ABL:親密 / 15
;EXキャラ補正(恋慕有りだと効果UP、恋慕無しだと珠なし)
IF CFLAG:0 && TALENT:恋慕
	TIMES L , 1.20
ELSEIF CFLAG:0 && TALENT:恋慕 == 0
	L = 0
ENDIF
IF L > 0
	IF ABL:MASTER:料理技能 >= 10 && TALENT:恋人
		JUEL:恭順 += L * 22
		JUEL:好意 += L * 33
		PRINTFORML %PALAMNAME:4%の珠＋{L*22}
		PRINTFORML %PALAMNAME:15%の珠＋{L*33}
	ELSE
		JUEL:恭順 += L * 11
		JUEL:好意 += L * 17
		PRINTFORML %PALAMNAME:4%の珠＋{L*11}
		PRINTFORML %PALAMNAME:15%の珠＋{L*17}
	ENDIF
ENDIF

IF R >= 10
	PRINTFORML %EXPNAME:90% ＋5
	EXP:MASTER:家事経験 += 5
ELSEIF R >= 5
	PRINTFORML %EXPNAME:90% ＋4
	EXP:MASTER:家事経験 += 4
ELSE
	PRINTFORML %EXPNAME:90% ＋3
	EXP:MASTER:家事経験 += 3
ENDIF
;好感度増加（浪費癖/10をマイナスし、Aがマイナスになる場合好感度は増加しない）
A = RAND:41 + 60 - (ABL:浪費癖 / 10)
IF A > 0
	CFLAG:2 += A
	PRINTFORMW 好感度が {A} 増えた
ENDIF
O = ABL:MASTER:料理技能 + (1 + RAND:5)
SIF ABL:MASTER:料理技能 < 9999
	FLAG:4 += O + R

IF ABL:MASTER:料理技能 < 5 && FLAG:4 >= 25
	TFLAG:14 += 10
ELSEIF ABL:MASTER:料理技能 < 20 && FLAG:4 >= 50
	TFLAG:14 += 10
ELSEIF ABL:MASTER:料理技能 < 50 && FLAG:4 >= 100
	TFLAG:14 += 10
ELSEIF ABL:MASTER:料理技能 < 60 && FLAG:4 >= 150
	TFLAG:14 += 10
ELSEIF ABL:MASTER:料理技能 < 70 && FLAG:4 >= 250
	TFLAG:14 += 10
ELSEIF ABL:MASTER:料理技能 < 90 && FLAG:4 >= 500
	TFLAG:14 += 10
ELSEIF ABL:MASTER:料理技能 < 1000 && FLAG:4 >= 1000
	TFLAG:14 += 10
ELSEIF ABL:MASTER:料理技能 >= 1000 && FLAG:4 >= 10000
	TFLAG:14 += 10
ENDIF

IF TFLAG:14 >= 10 && ABL:MASTER:料理技能 < 9999
	ABL:MASTER:料理技能 += 1
	PRINTL  
	PRINTFORML %CALLNAME:MASTER%の%ABLNAME:90%のレベルが{ABL:MASTER:料理技能}になりました。
	FLAG:4 = 0
	TFLAG:14 -= 10
ENDIF
WAIT

;食後の運動イベント
IF TFLAG:14 == 1 && (TALENT:合意 || TALENT:恋人) && TALENT:処女 == 0 && TALENT:MASTER:童貞 == 0
	CALL LUNCH_EXERCISE
ELSE
	TFLAG:14 = 0
ENDIF

;休憩フラグを立てる
FLAG:0 = 1
BEGIN TURNEND
RETURN 1
