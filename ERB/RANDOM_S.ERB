@CHARA_RANDOM_STATE
;ここでランダムに素質と経験を決定
;TARGET保存
LOCAL = TARGET
TARGET = A

;素質
REPEAT 26
	O = COUNT
	
	IF O == 0
		;体力
		MAXBASE:体力 += 100 * RAND:11
	ELSEIF O == 1
		;気力
		MAXBASE:気力 += 100 * RAND:11
	ELSEIF O == 2
		;処女
		P = RAND:4
		SIF P > 0
			TALENT:処女 = 1
	ELSEIF O == 3
		;臆病・気丈
		P = RAND:4
		IF P == 0
			TALENT:臆病 = 1
			TALENT:気丈 = 0
		ELSEIF P == 1
			TALENT:気丈 = 1
			TALENT:臆病 = 0
		ENDIF
	ELSEIF O == 5
		;好奇心・楽観的
		SIF RAND:2 == 0
			TALENT:好奇心 = 1
		SIF RAND:3 == 0
			TALENT:楽観的 = 1
	ELSEIF O == 6
		;恥じらい・恥薄い
		P = RAND:4
		IF P == 0
			TALENT:恥じらい = 1
			TALENT:恥薄い = 0
		ELSEIF P == 1
			TALENT:恥薄い = 1
			TALENT:恥じらい = 0
		ENDIF
	ELSEIF O == 7
		;痛みに弱い・痛みに強い・サド
		P = RAND:4
		IF P == 0
			TALENT:痛みに弱い = 1
			TALENT:痛みに強い = 0
		ELSEIF P == 1
			TALENT:痛みに強い = 1
			TALENT:痛みに弱い = 0
		ENDIF
		P = RAND:8
		IF P <= 2 && (CFLAG:14 == 5 || CFLAG:14 == 6)
			;天狗
			TALENT:サド = 1
		ELSEIF P == 0
			TALENT:サド = 1
		ENDIF
	ELSEIF O == 8
		;濡れやすい・濡れにくい
		P = RAND:4
		IF P == 0
			TALENT:濡れやすい = 1
			TALENT:濡れにくい = 0
		ELSEIF P == 1
			TALENT:濡れにくい = 1
			TALENT:濡れやすい = 0
		ENDIF
	ELSEIF O == 9
		;習得早い・習得遅い
		P = RAND:4
		IF P == 0
			TALENT:習得早い = 1
			TALENT:習得遅い = 0
		ELSEIF P == 1
			TALENT:習得遅い = 1
			TALENT:習得早い = 0
		ENDIF
	ELSEIF O == 10
		;汚臭鈍感・汚臭敏感
		P = RAND:4
		IF P == 0
			TALENT:汚臭鈍感 = 1
			TALENT:汚臭敏感 = 0
		ELSEIF P == 1
			TALENT:汚臭敏感 = 1
			TALENT:汚臭鈍感 = 0
		ENDIF
	ELSEIF O == 11
		;自慰しやすい・中毒しやすい・献身的
		P = RAND:3
		SIF P == 0
			TALENT:自慰しやすい = 1
		P = RAND:3
		SIF P == 0
			TALENT:中毒しやすい = 1
		P = RAND:3
		SIF P == 0
			TALENT:献身的 = 1
	ELSEIF O == 12
		;Ｃ鈍感・Ｃ敏感
		P = RAND:4
		IF P == 0
			TALENT:Ｃ鈍感 = 1
			TALENT:Ｃ敏感 = 0
		ELSEIF P == 1
			TALENT:Ｃ敏感 = 1
			TALENT:Ｃ鈍感 = 0
		ENDIF
	ELSEIF O == 13
		;Ｖ鈍感・Ｖ敏感
		P = RAND:4
		IF P == 0
			TALENT:Ｖ鈍感 = 1
			TALENT:Ｖ敏感 = 0
		ELSEIF P == 1
			TALENT:Ｖ敏感 = 1
			TALENT:Ｖ鈍感 = 0
		ENDIF
	ELSEIF O == 14
		;Ａ鈍感・Ａ敏感
		P = RAND:4
		IF P == 0
			TALENT:Ａ鈍感 = 1
			TALENT:Ａ敏感 = 0
		ELSEIF P == 1
			TALENT:Ａ敏感 = 1
			TALENT:Ａ鈍感 = 0
		ENDIF
	ELSEIF O == 15
		;Ｂ鈍感・Ｂ敏感
		P = RAND:4
		IF P == 0
			TALENT:Ｂ鈍感 = 1
			TALENT:Ｂ敏感 = 0
		ELSEIF P == 1
			TALENT:Ｂ敏感 = 1
			TALENT:Ｂ鈍感 = 0
		ENDIF
	ELSEIF O == 16
		;貧乳・巨乳
		P = RAND:6
		IF P <= 2
			TALENT:貧乳 = 1
			TALENT:巨乳 = 0
		ELSEIF P == 3
			TALENT:巨乳 = 1
			TALENT:貧乳 = 0
		ENDIF
	ELSEIF O == 17
		;回復早い・回復遅い
		IF CFLAG:14 == 0
			;妖精
			P = RAND:4
			IF P > 0
				IF TALENT:回復遅い == 0
					TALENT:回復早い = 1
				ELSE
					TALENT:回復遅い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 1
			;人間
			P = RAND:8
			IF P < 2
				IF TALENT:回復遅い == 0
					TALENT:回復早い = 1
				ELSE
					TALENT:回復遅い = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:回復早い == 0
					TALENT:回復遅い = 1
				ELSE
					TALENT:回復早い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 2 || CFLAG:14 == 5 || CFLAG:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P < 4
				IF TALENT:回復遅い == 0
					TALENT:回復早い = 1
				ELSE
					TALENT:回復遅い = 0
				ENDIF
			ELSEIF P > 6
				IF TALENT:回復早い == 0
					TALENT:回復遅い = 1
				ELSE
					TALENT:回復早い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 3
			;人形
			P = RAND:8
			IF P < 1
				IF TALENT:回復遅い == 0
					TALENT:回復早い = 1
				ELSE
					TALENT:回復遅い = 0
				ENDIF
			ELSEIF P > 4
				IF TALENT:回復早い == 0
					TALENT:回復遅い = 1
				ELSE
					TALENT:回復早い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 4
			;魔界人
			P = RAND:8
			IF P < 3
				IF TALENT:回復遅い == 0
					TALENT:回復早い = 1
				ELSE
					TALENT:回復遅い = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:回復早い == 0
					TALENT:回復遅い = 1
				ELSE
					TALENT:回復早い = 0
				ENDIF
			ENDIF
		ENDIF
	ELSEIF O == 18
		;魅力・両刀
		P = RAND:4
		SIF P > 1
			TALENT:魅力 = 1
		P = RAND:16
		IF P <= 3 && (CFLAG:14 == 5 || CFLAG:14 == 6)
			;天狗
			TALENT:両刀 = 1
		ELSEIF P <= 1 && CFLAG:14 == 2
			;妖怪兎
			TALENT:両刀 = 1
		ELSEIF P == 0
			TALENT:両刀 = 1
		ENDIF
	ELSEIF O == 19
		;日光浴・月光浴
		IF CFLAG:14 == 0
			;妖精
			P = RAND:4
			IF P == 0
				TALENT:日光浴 = 1
			ELSEIF P == 1
				TALENT:月光浴 = 1
			ENDIF
		ELSEIF CFLAG:14 == 1 || CFLAG:14 == 3
			;人間、人形
			P = RAND:16
			IF P == 0
				TALENT:日光浴 = 1
			ELSEIF P == 1
				TALENT:月光浴 = 1
			ENDIF
		ELSEIF CFLAG:14 == 2 || CFLAG:14 == 5 || CFLAG:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P == 0
				TALENT:日光浴 = 1
			ELSEIF P == 1
				TALENT:月光浴 = 1
			ENDIF
		ELSEIF CFLAG:14 == 4
			;魔界人
			P = RAND:6
			IF P == 0
				TALENT:日光浴 = 1
			ELSEIF P <= 3
				TALENT:月光浴 = 1
			ENDIF
		ENDIF
	ELSEIF O == 20
		;鼓舞
		P = RAND:4
		SIF P == 0
			TALENT:鼓舞 = 1
	ELSEIF O == 21
		;幼稚・小悪魔
		P = RAND:4
		IF P == 0 && CFLAG:14 == 0
			TALENT:幼稚 = 1
		ELSEIF P == 1
			TALENT:小悪魔 = 1
		ENDIF
	ELSEIF O == 22
		;プライド高い・プライド低い
		P = RAND:4
		IF P == 0
			TALENT:プライド高い = 1
			TALENT:プライド低い = 0
		ELSEIF P == 1
			TALENT:プライド低い = 1
			TALENT:プライド高い = 0
		ENDIF
	ELSEIF O == 23
		;貞操観念・貞操無頓着
		P = RAND:4
		IF P == 0 && TALENT:貞操無頓着 == 0
			TALENT:貞操観念 = 1
		ELSEIF P == 1 && TALENT:貞操観念 == 0
			TALENT:貞操無頓着 = 1
		ENDIF
	ELSEIF O == 24
		;マイナス素質のオンパレード
		P = RAND:2
		IF P == 0
			;男嫌い(両刀が無い時に限る)・嫉妬
			P = RAND:12
			IF P < 2 && TALENT:両刀 == 0
				TALENT:男嫌い = 1
			ELSEIF P >= 1 && P < 3
				TALENT:嫉妬 = 1
			ENDIF
			;快感の否定・一線越えない
			P = RAND:16
			SIF P < 2
				TALENT:快感の否定 = 1
			SIF P >= 1 && P <= 3
				TALENT:一線越えない = 1
			;抑圧
			P = RAND:8
			SIF P == 0
				TALENT:抑圧 = 1
			;保守的
			P = RAND:8
			SIF P == 0
				TALENT:保守的 = 1
			;抵抗
			P = RAND:8
			SIF P == 0
				TALENT:抵抗 = 1
			;反抗的
			P = RAND:8
			SIF P == 0 && TALENT:素直 == 0
				TALENT:反抗的 = 1
		ENDIF
	ELSEIF O == 25
		;ツンデレ追加判定。強制的に反抗的が付加、素直が削除されます
		P = RAND:8
		IF P == 0
			TALENT:ツンデレ = 1
			SIF TALENT:素直
				TALENT:素直 = 0
			SIF TALENT:反抗的 == 0
				TALENT:反抗的 = 1
		ENDIF
	ENDIF
REND
;能力
REPEAT 4
	O = COUNT
	
	IF O == 0
		;従順
		P = RAND:2
		SIF P > 0
			ABL:親密 += RAND:2
	ELSEIF O == 1
		;欲望
		P = RAND:3
		SIF P > 0
			ABL:欲望 += RAND:2
	ELSEIF O == 2
		;技巧
		P = RAND:4
		SIF P > 0
			ABL:技巧 += 1 + RAND:2
	ELSEIF O == 3
		;レズっ気
		P = RAND:16
		SIF P > 0
			ABL:レズっ気 += RAND:3
	ENDIF
REND
;経験
REPEAT 5
	O = COUNT
	
	IF O == 0 && TALENT:処女 == 0
		;Ｖ経験
		P = RAND:8
		SIF P > 0
			EXP:Ｖ経験 += 1 + RAND:2
	ELSEIF O == 1
		;Ａ経験
		P = RAND:8
		SIF P > 0
			EXP:Ａ経験 += RAND:4
	ELSEIF O == 2
		;絶頂経験
		P = RAND:4
		SIF P > 0
			EXP:絶頂経験 += RAND:5
	ELSEIF O == 3
		;自慰経験
		P = RAND:4
		SIF P > 0
			EXP:自慰経験 += RAND:7
	ELSEIF O == 4
		;異常経験
		P = RAND:4
		SIF P > 0
			EXP:異常経験 += RAND:2
	ENDIF
REND
;反発感情
P = RAND:3
SIF P == 0
	MARK:3 += RAND:4

;体力、気力が上昇していた場合、全快させる
SIF BASE:体力 != MAXBASE:体力
	BASE:体力 = MAXBASE:体力
SIF BASE:気力 != MAXBASE:気力
	BASE:気力 = MAXBASE:気力

;TARGETを戻す
TARGET = LOCAL

RETURN 1

@SELL_CHARA_RANDOM
;キャラを売る際CFLAGを全て消去
;CFLAG消去
REPEAT 421
	O = COUNT
	CFLAG:O = 0
REND
;キャラ販売フラグ復活
FLAG:1098 = 200
SIF FLAG:5098
	FLAG:5098 = 0
RETURN 1

@CHARA_RANDOM_STATE_M
;EXモードで主人をランダムキャラに設定した場合、ここでその処理を行う
;ここでランダムに素質と経験を決定
;素質
REPEAT 23
	O = COUNT
	
	IF O == 0
		;体力
		MAXBASE:MASTER:体力 += 100 * RAND:11
	ELSEIF O == 1
		;気力
		MAXBASE:MASTER:気力 += 100 * RAND:11
	ELSEIF O == 2
		;処女
		P = RAND:4
		SIF P > 0
			TALENT:MASTER:処女 = 1
	ELSEIF O == 3
		;臆病・気丈
		P = RAND:4
		IF P == 0
			TALENT:MASTER:臆病 = 1
		ELSEIF P == 1
			TALENT:MASTER:気丈 = 1
		ENDIF
	ELSEIF O == 5
		;好奇心・楽観的
		P = RAND:2
		SIF P == 0
			TALENT:MASTER:好奇心 = 1
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:楽観的 = 1
	ELSEIF O == 6
		;恥じらい・恥薄い
		P = RAND:4
		IF P == 0
			TALENT:MASTER:恥じらい = 1
		ELSEIF P == 1
			TALENT:MASTER:恥薄い = 1
		ENDIF
	ELSEIF O == 7
		;痛みに弱い・痛みに強い・サド
		P = RAND:4
		IF P == 0
			TALENT:MASTER:痛みに弱い = 1
		ELSEIF P == 1
			TALENT:MASTER:痛みに強い = 1
		ENDIF
		P = RAND:8
		IF P <= 2 && (CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6)
			;天狗
			TALENT:MASTER:サド = 1
		ELSEIF P == 0
			TALENT:MASTER:サド = 1
		ENDIF
	ELSEIF O == 8
		;濡れやすい・濡れにくい
		P = RAND:4
		IF P == 0
			TALENT:MASTER:濡れやすい = 1
		ELSEIF P == 1
			TALENT:MASTER:濡れにくい = 1
		ENDIF
	ELSEIF O == 9
		;習得早い・習得遅い
		P = RAND:4
		IF P == 0
			TALENT:MASTER:習得早い = 1
		ELSEIF P == 1
			TALENT:MASTER:習得遅い = 1
		ENDIF
	ELSEIF O == 10
		;汚臭鈍感・汚臭敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:汚臭鈍感 = 1
		ELSEIF P == 1
			TALENT:MASTER:汚臭敏感 = 1
		ENDIF
	ELSEIF O == 11
		;自慰しやすい・中毒しやすい・献身的
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:自慰しやすい = 1
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:中毒しやすい = 1
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:献身的 = 1
	ELSEIF O == 12
		;Ｃ鈍感・Ｃ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:Ｃ鈍感 = 1
		ELSEIF P == 1
			TALENT:MASTER:Ｃ敏感 = 1
		ENDIF
	ELSEIF O == 13
		;Ｖ鈍感・Ｖ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:Ｖ鈍感 = 1
		ELSEIF P == 1
			TALENT:MASTER:Ｖ敏感 = 1
		ENDIF
	ELSEIF O == 14
		;Ａ鈍感・Ａ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:Ａ鈍感 = 1
		ELSEIF P == 1
			TALENT:MASTER:Ａ敏感 = 1
		ENDIF
	ELSEIF O == 15
		;Ｂ鈍感・Ｂ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:Ｂ鈍感 = 1
		ELSEIF P == 1
			TALENT:MASTER:Ｂ敏感 = 1
		ENDIF
	ELSEIF O == 16
		;貧乳・巨乳
		P = RAND:6
		IF P <= 2
			TALENT:MASTER:貧乳 = 1
		ELSEIF P == 3
			TALENT:MASTER:巨乳 = 1
		ENDIF
	ELSEIF O == 17
		;回復早い・回復遅い
		IF CFLAG:MASTER:14 == 0
			;妖精
			P = RAND:4
			IF P > 0
				IF TALENT:MASTER:回復遅い == 0
					TALENT:MASTER:回復早い = 1
				ELSE
					TALENT:MASTER:回復遅い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 1
			;人間
			P = RAND:8
			IF P < 2
				IF TALENT:MASTER:回復遅い == 0
					TALENT:MASTER:回復早い = 1
				ELSE
					TALENT:MASTER:回復遅い = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:MASTER:回復早い == 0
					TALENT:MASTER:回復遅い = 1
				ELSE
					TALENT:MASTER:回復早い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 2 || CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P < 4
				IF TALENT:MASTER:回復遅い == 0
					TALENT:MASTER:回復早い = 1
				ELSE
					TALENT:MASTER:回復遅い = 0
				ENDIF
			ELSEIF P > 6
				IF TALENT:MASTER:回復早い == 0
					TALENT:MASTER:回復遅い = 1
				ELSE
					TALENT:MASTER:回復早い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 3
			;人形
			P = RAND:8
			IF P < 1
				IF TALENT:MASTER:回復遅い == 0
					TALENT:MASTER:回復早い = 1
				ELSE
					TALENT:MASTER:回復遅い = 0
				ENDIF
			ELSEIF P > 4
				IF TALENT:MASTER:回復早い == 0
					TALENT:MASTER:回復遅い = 1
				ELSE
					TALENT:MASTER:回復早い = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 4
			;魔界人
			P = RAND:8
			IF P < 3
				IF TALENT:回復遅い == 0
					TALENT:回復早い = 1
				ELSE
					TALENT:回復遅い = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:回復早い == 0
					TALENT:回復遅い = 1
				ELSE
					TALENT:回復早い = 0
				ENDIF
			ENDIF
		ENDIF
	ELSEIF O == 18
		;魅力・両刀
		P = RAND:4
		SIF P > 1
			TALENT:MASTER:魅力 = 1
		P = RAND:16
		IF P <= 3 && (CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6)
			;天狗
			TALENT:両刀 = 1
		ELSEIF P <= 1 && CFLAG:MASTER:14 == 2
			;妖怪兎
			TALENT:MASTER:両刀 = 1
		ELSEIF P == 0
			TALENT:MASTER:両刀 = 1
		ENDIF
	ELSEIF O == 19
		;日光浴・月光浴
		IF CFLAG:MASTER:14 == 0
			;妖精
			P = RAND:4
			IF P == 0
				TALENT:MASTER:日光浴 = 1
			ELSEIF P == 1
				TALENT:MASTER:月光浴 = 1
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 1 || CFLAG:MASTER:14 == 3
			;人間、人形
			P = RAND:16
			IF P == 0
				TALENT:MASTER:日光浴 = 1
			ELSEIF P == 1
				TALENT:MASTER:月光浴 = 1
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 2 || CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P == 0
				TALENT:MASTER:日光浴 = 1
			ELSEIF P == 1
				TALENT:MASTER:月光浴 = 1
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 4
			;魔界人
			P = RAND:6
			IF P == 0
				TALENT:MASTER:日光浴 = 1
			ELSEIF P <= 3
				TALENT:MASTER:月光浴 = 1
			ENDIF
		ENDIF
	ELSEIF O == 20
		;鼓舞
		P = RAND:4
		SIF P == 0
			TALENT:MASTER:鼓舞 = 1
	ELSEIF O == 21
		;幼稚・小悪魔
		P = RAND:4
		IF P == 0 && CFLAG:MASTER:14 == 0
			TALENT:MASTER:幼稚 = 1
		ELSEIF P == 1
			TALENT:MASTER:小悪魔 = 1
		ENDIF
	ENDIF
REND
;能力
REPEAT 4
	O = COUNT
	IF O == 0
		;欲望
		P = RAND:3
		SIF P > 0
			ABL:MASTER:欲望 += RAND:2
	ELSEIF O == 1
		;技巧
		P = RAND:4
		SIF P > 0
			ABL:MASTER:技巧 += 1 + RAND:2
	ELSEIF O == 2
		;レズっ気
		P = RAND:16
		SIF P > 0
			ABL:MASTER:レズっ気 += RAND:3
	ELSEIF O == 3
		;レズ中毒
		P = RAND:3
		SIF P == 0 && ABL:MASTER:レズっ気
			ABL:MASTER:レズ中毒 += RAND:3
	ENDIF
REND
;経験
REPEAT 5
	O = COUNT
	
	IF O == 0 && TALENT:MASTER:処女 == 0
		;Ｖ経験
		P = RAND:8
		SIF P > 0
			EXP:MASTER:Ｖ経験 += 1 + RAND:2
	ELSEIF O == 1
		;Ａ経験
		P = RAND:8
		SIF P > 0
			EXP:MASTER:Ａ経験 += RAND:4
	ELSEIF O == 2
		;絶頂経験
		P = RAND:4
		SIF P > 0
			EXP:MASTER:絶頂経験 += RAND:5
	ELSEIF O == 3
		;自慰経験
		P = RAND:4
		SIF P > 0
			EXP:MASTER:自慰経験 += RAND:7
	ELSEIF O == 4
		;異常経験
		P = RAND:4
		SIF P > 0
			EXP:MASTER:異常経験 += RAND:2
	ENDIF
REND

;体力、気力が上昇していた場合、全快させる
SIF BASE:MASTER:体力 != MAXBASE:MASTER:体力
	BASE:MASTER:体力 = MAXBASE:MASTER:体力
SIF BASE:MASTER:気力 != MAXBASE:MASTER:気力
	BASE:MASTER:気力 = MAXBASE:MASTER:気力

RETURN 1
