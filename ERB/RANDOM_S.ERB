@CHARA_RANDOM_STATE
;ここでランダムに素質と経験を決定
;TARGET保存
LOCAL = TARGET
TARGET = A

;素質
REPEAT 26
	O = COUNT
	
	IF O == 0
		;体力
		MAXBASE:0 += 100 * RAND:11
	ELSEIF O == 1
		;気力
		MAXBASE:1 += 100 * RAND:11
	ELSEIF O == 2
		;処女
		P = RAND:4
		SIF P > 0
			TALENT:0 = 1
	ELSEIF O == 3
		;臆病・気丈
		P = RAND:4
		IF P == 0
			TALENT:10 = 1
			TALENT:12 = 0
		ELSEIF P == 1
			TALENT:12 = 1
			TALENT:10 = 0
		ENDIF
	ELSEIF O == 5
		;好奇心・楽観的
		SIF RAND:2 == 0
			TALENT:23 = 1
		SIF RAND:3 == 0
			TALENT:25 = 1
	ELSEIF O == 6
		;恥じらい・恥薄い
		P = RAND:4
		IF P == 0
			TALENT:35 = 1
			TALENT:36 = 0
		ELSEIF P == 1
			TALENT:36 = 1
			TALENT:35 = 0
		ENDIF
	ELSEIF O == 7
		;痛みに弱い・痛みに強い・サド
		P = RAND:4
		IF P == 0
			TALENT:40 = 1
			TALENT:41 = 0
		ELSEIF P == 1
			TALENT:41 = 1
			TALENT:40 = 0
		ENDIF
		P = RAND:8
		IF P <= 2 && (CFLAG:14 == 5 || CFLAG:14 == 6)
			;天狗
			TALENT:83 = 1
		ELSEIF P == 0
			TALENT:83 = 1
		ENDIF
	ELSEIF O == 8
		;濡れやすい・濡れにくい
		P = RAND:4
		IF P == 0
			TALENT:42 = 1
			TALENT:43 = 0
		ELSEIF P == 1
			TALENT:43 = 1
			TALENT:42 = 0
		ENDIF
	ELSEIF O == 9
		;習得早い・習得遅い
		P = RAND:4
		IF P == 0
			TALENT:50 = 1
			TALENT:51 = 0
		ELSEIF P == 1
			TALENT:51 = 1
			TALENT:50 = 0
		ENDIF
	ELSEIF O == 10
		;汚臭鈍感・汚臭敏感
		P = RAND:4
		IF P == 0
			TALENT:61 = 1
			TALENT:62 = 0
		ELSEIF P == 1
			TALENT:62 = 1
			TALENT:61 = 0
		ENDIF
	ELSEIF O == 11
		;自慰しやすい・中毒しやすい・献身的
		P = RAND:3
		SIF P == 0
			TALENT:60 = 1
		P = RAND:3
		SIF P == 0
			TALENT:72 = 1
		P = RAND:3
		SIF P == 0
			TALENT:63 = 1
	ELSEIF O == 12
		;Ｃ鈍感・Ｃ敏感
		P = RAND:4
		IF P == 0
			TALENT:101 = 1
			TALENT:102 = 0
		ELSEIF P == 1
			TALENT:102 = 1
			TALENT:101 = 0
		ENDIF
	ELSEIF O == 13
		;Ｖ鈍感・Ｖ敏感
		P = RAND:4
		IF P == 0
			TALENT:103 = 1
			TALENT:104 = 0
		ELSEIF P == 1
			TALENT:104 = 1
			TALENT:103 = 0
		ENDIF
	ELSEIF O == 14
		;Ａ鈍感・Ａ敏感
		P = RAND:4
		IF P == 0
			TALENT:105 = 1
			TALENT:106 = 0
		ELSEIF P == 1
			TALENT:106 = 1
			TALENT:105 = 0
		ENDIF
	ELSEIF O == 15
		;Ｂ鈍感・Ｂ敏感
		P = RAND:4
		IF P == 0
			TALENT:107 = 1
			TALENT:108 = 0
		ELSEIF P == 1
			TALENT:108 = 1
			TALENT:107 = 0
		ENDIF
	ELSEIF O == 16
		;貧乳・巨乳
		P = RAND:6
		IF P <= 2
			TALENT:109 = 1
			TALENT:110 = 0
		ELSEIF P == 3
			TALENT:110 = 1
			TALENT:109 = 0
		ENDIF
	ELSEIF O == 17
		;回復早い・回復遅い
		IF CFLAG:14 == 0
			;妖精
			P = RAND:4
			IF P > 0
				IF TALENT:112 == 0
					TALENT:111 = 1
				ELSE
					TALENT:112 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 1
			;人間
			P = RAND:8
			IF P < 2
				IF TALENT:112 == 0
					TALENT:111 = 1
				ELSE
					TALENT:112 = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:111 == 0
					TALENT:112 = 1
				ELSE
					TALENT:111 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 2 || CFLAG:14 == 5 || CFLAG:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P < 4
				IF TALENT:112 == 0
					TALENT:111 = 1
				ELSE
					TALENT:112 = 0
				ENDIF
			ELSEIF P > 6
				IF TALENT:111 == 0
					TALENT:112 = 1
				ELSE
					TALENT:111 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 3
			;人形
			P = RAND:8
			IF P < 1
				IF TALENT:112 == 0
					TALENT:111 = 1
				ELSE
					TALENT:112 = 0
				ENDIF
			ELSEIF P > 4
				IF TALENT:111 == 0
					TALENT:112 = 1
				ELSE
					TALENT:111 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:14 == 4
			;魔界人
			P = RAND:8
			IF P < 3
				IF TALENT:112 == 0
					TALENT:111 = 1
				ELSE
					TALENT:112 = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:111 == 0
					TALENT:112 = 1
				ELSE
					TALENT:111 = 0
				ENDIF
			ENDIF
		ENDIF
	ELSEIF O == 18
		;魅力・両刀
		P = RAND:4
		SIF P > 1
			TALENT:113 = 1
		P = RAND:16
		IF P <= 3 && (CFLAG:14 == 5 || CFLAG:14 == 6)
			;天狗
			TALENT:81 = 1
		ELSEIF P <= 1 && CFLAG:14 == 2
			;妖怪兎
			TALENT:81 = 1
		ELSEIF P == 0
			TALENT:81 = 1
		ENDIF
	ELSEIF O == 19
		;日光浴・月光浴
		IF CFLAG:14 == 0
			;妖精
			P = RAND:4
			IF P == 0
				TALENT:115 = 1
			ELSEIF P == 1
				TALENT:116 = 1
			ENDIF
		ELSEIF CFLAG:14 == 1 || CFLAG:14 == 3
			;人間、人形
			P = RAND:16
			IF P == 0
				TALENT:115 = 1
			ELSEIF P == 1
				TALENT:116 = 1
			ENDIF
		ELSEIF CFLAG:14 == 2 || CFLAG:14 == 5 || CFLAG:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P == 0
				TALENT:115 = 1
			ELSEIF P == 1
				TALENT:116 = 1
			ENDIF
		ELSEIF CFLAG:14 == 4
			;魔界人
			P = RAND:6
			IF P == 0
				TALENT:115 = 1
			ELSEIF P <= 3
				TALENT:116 = 1
			ENDIF
		ENDIF
	ELSEIF O == 20
		;鼓舞
		P = RAND:4
		SIF P == 0
			TALENT:118 = 1
	ELSEIF O == 21
		;幼稚・小悪魔
		P = RAND:4
		IF P == 0 && CFLAG:14 == 0
			TALENT:132 = 1
		ELSEIF P == 1
			TALENT:87 = 1
		ENDIF
	ELSEIF O == 22
		;プライド高い・プライド低い
		P = RAND:4
		IF P == 0
			TALENT:15 = 1
			TALENT:17 = 0
		ELSEIF P == 1
			TALENT:17 = 1
			TALENT:15 = 0
		ENDIF
	ELSEIF O == 23
		;貞操観念・貞操無頓着
		P = RAND:4
		IF P == 0 && TALENT:31 == 0
			TALENT:30 = 1
		ELSEIF P == 1 && TALENT:30 == 0
			TALENT:31 = 1
		ENDIF
	ELSEIF O == 24
		;マイナス素質のオンパレード
		P = RAND:2
		IF P == 0
			;男嫌い(両刀が無い時に限る)・嫉妬
			P = RAND:12
			IF P < 2 && TALENT:81 == 0
				TALENT:82 = 1
			ELSEIF P >= 1 && P < 3
				TALENT:84 = 1
			ENDIF
			;快感の否定・一線越えない
			P = RAND:16
			SIF P < 2
				TALENT:71 = 1
			SIF P >= 1 && P <= 3
				TALENT:27 = 1
			;抑圧
			P = RAND:8
			SIF P == 0
				TALENT:32 = 1
			;保守的
			P = RAND:8
			SIF P == 0
				TALENT:24 = 1
			;抵抗
			P = RAND:8
			SIF P == 0
				TALENT:34 = 1
			;反抗的
			P = RAND:8
			SIF P == 0 && TALENT:13 == 0
				TALENT:11 = 1
		ENDIF
	ELSEIF O == 25
		;ツンデレ追加判定。強制的に反抗的が付加、素直が削除されます
		P = RAND:8
		IF P == 0
			TALENT:18 = 1
			SIF TALENT:13
				TALENT:13 = 0
			SIF TALENT:11 == 0
				TALENT:11 = 1
		ENDIF
	ENDIF
REND
;能力
REPEAT 4
	O = COUNT
	
	IF O == 0
		;従順
		P = RAND:2
		SIF P > 0
			ABL:親密 += RAND:2
	ELSEIF O == 1
		;欲望
		P = RAND:3
		SIF P > 0
			ABL:欲望 += RAND:2
	ELSEIF O == 2
		;技巧
		P = RAND:4
		SIF P > 0
			ABL:技巧 += 1 + RAND:2
	ELSEIF O == 3
		;レズっ気
		P = RAND:16
		SIF P > 0
			ABL:レズっ気 += RAND:3
	ENDIF
REND
;経験
REPEAT 5
	O = COUNT
	
	IF O == 0 && TALENT:0 == 0
		;Ｖ経験
		P = RAND:8
		SIF P > 0
			EXP:0 += 1 + RAND:2
	ELSEIF O == 1
		;Ａ経験
		P = RAND:8
		SIF P > 0
			EXP:1 += RAND:4
	ELSEIF O == 2
		;絶頂経験
		P = RAND:4
		SIF P > 0
			EXP:2 += RAND:5
	ELSEIF O == 3
		;自慰経験
		P = RAND:4
		SIF P > 0
			EXP:10 += RAND:7
	ELSEIF O == 4
		;異常経験
		P = RAND:4
		SIF P > 0
			EXP:50 += RAND:2
	ENDIF
REND
;反発感情
P = RAND:3
SIF P == 0
	MARK:3 += RAND:4

;体力、気力が上昇していた場合、全快させる
SIF BASE:0 != MAXBASE:0
	BASE:0 = MAXBASE:0
SIF BASE:1 != MAXBASE:1
	BASE:1 = MAXBASE:1

;TARGETを戻す
TARGET = LOCAL

RETURN 1

@SELL_CHARA_RANDOM
;キャラを売る際CFLAGを全て消去
;CFLAG消去
REPEAT 421
	O = COUNT
	CFLAG:O = 0
REND
;キャラ販売フラグ復活
FLAG:1098 = 200
SIF FLAG:5098
	FLAG:5098 = 0
RETURN 1

@CHARA_RANDOM_STATE_M
;EXモードで主人をランダムキャラに設定した場合、ここでその処理を行う
;ここでランダムに素質と経験を決定
;素質
REPEAT 23
	O = COUNT
	
	IF O == 0
		;体力
		MAXBASE:MASTER:0 += 100 * RAND:11
	ELSEIF O == 1
		;気力
		MAXBASE:MASTER:1 += 100 * RAND:11
	ELSEIF O == 2
		;処女
		P = RAND:4
		SIF P > 0
			TALENT:MASTER:0 = 1
	ELSEIF O == 3
		;臆病・気丈
		P = RAND:4
		IF P == 0
			TALENT:MASTER:10 = 1
		ELSEIF P == 1
			TALENT:MASTER:12 = 1
		ENDIF
	ELSEIF O == 5
		;好奇心・楽観的
		P = RAND:2
		SIF P == 0
			TALENT:MASTER:23 = 1
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:25 = 1
	ELSEIF O == 6
		;恥じらい・恥薄い
		P = RAND:4
		IF P == 0
			TALENT:MASTER:35 = 1
		ELSEIF P == 1
			TALENT:MASTER:36 = 1
		ENDIF
	ELSEIF O == 7
		;痛みに弱い・痛みに強い・サド
		P = RAND:4
		IF P == 0
			TALENT:MASTER:40 = 1
		ELSEIF P == 1
			TALENT:MASTER:41 = 1
		ENDIF
		P = RAND:8
		IF P <= 2 && (CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6)
			;天狗
			TALENT:MASTER:83 = 1
		ELSEIF P == 0
			TALENT:MASTER:83 = 1
		ENDIF
	ELSEIF O == 8
		;濡れやすい・濡れにくい
		P = RAND:4
		IF P == 0
			TALENT:MASTER:42 = 1
		ELSEIF P == 1
			TALENT:MASTER:43 = 1
		ENDIF
	ELSEIF O == 9
		;習得早い・習得遅い
		P = RAND:4
		IF P == 0
			TALENT:MASTER:50 = 1
		ELSEIF P == 1
			TALENT:MASTER:51 = 1
		ENDIF
	ELSEIF O == 10
		;汚臭鈍感・汚臭敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:61 = 1
		ELSEIF P == 1
			TALENT:MASTER:62 = 1
		ENDIF
	ELSEIF O == 11
		;自慰しやすい・中毒しやすい・献身的
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:60 = 1
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:72 = 1
		P = RAND:3
		SIF P == 0
			TALENT:MASTER:63 = 1
	ELSEIF O == 12
		;Ｃ鈍感・Ｃ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:101 = 1
		ELSEIF P == 1
			TALENT:MASTER:102 = 1
		ENDIF
	ELSEIF O == 13
		;Ｖ鈍感・Ｖ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:103 = 1
		ELSEIF P == 1
			TALENT:MASTER:104 = 1
		ENDIF
	ELSEIF O == 14
		;Ａ鈍感・Ａ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:105 = 1
		ELSEIF P == 1
			TALENT:MASTER:106 = 1
		ENDIF
	ELSEIF O == 15
		;Ｂ鈍感・Ｂ敏感
		P = RAND:4
		IF P == 0
			TALENT:MASTER:107 = 1
		ELSEIF P == 1
			TALENT:MASTER:108 = 1
		ENDIF
	ELSEIF O == 16
		;貧乳・巨乳
		P = RAND:6
		IF P <= 2
			TALENT:MASTER:109 = 1
		ELSEIF P == 3
			TALENT:MASTER:110 = 1
		ENDIF
	ELSEIF O == 17
		;回復早い・回復遅い
		IF CFLAG:MASTER:14 == 0
			;妖精
			P = RAND:4
			IF P > 0
				IF TALENT:MASTER:112 == 0
					TALENT:MASTER:111 = 1
				ELSE
					TALENT:MASTER:112 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 1
			;人間
			P = RAND:8
			IF P < 2
				IF TALENT:MASTER:112 == 0
					TALENT:MASTER:111 = 1
				ELSE
					TALENT:MASTER:112 = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:MASTER:111 == 0
					TALENT:MASTER:112 = 1
				ELSE
					TALENT:MASTER:111 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 2 || CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P < 4
				IF TALENT:MASTER:112 == 0
					TALENT:MASTER:111 = 1
				ELSE
					TALENT:MASTER:112 = 0
				ENDIF
			ELSEIF P > 6
				IF TALENT:MASTER:111 == 0
					TALENT:MASTER:112 = 1
				ELSE
					TALENT:MASTER:111 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 3
			;人形
			P = RAND:8
			IF P < 1
				IF TALENT:MASTER:112 == 0
					TALENT:MASTER:111 = 1
				ELSE
					TALENT:MASTER:112 = 0
				ENDIF
			ELSEIF P > 4
				IF TALENT:MASTER:111 == 0
					TALENT:MASTER:112 = 1
				ELSE
					TALENT:MASTER:111 = 0
				ENDIF
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 4
			;魔界人
			P = RAND:8
			IF P < 3
				IF TALENT:112 == 0
					TALENT:111 = 1
				ELSE
					TALENT:112 = 0
				ENDIF
			ELSEIF P > 5
				IF TALENT:111 == 0
					TALENT:112 = 1
				ELSE
					TALENT:111 = 0
				ENDIF
			ENDIF
		ENDIF
	ELSEIF O == 18
		;魅力・両刀
		P = RAND:4
		SIF P > 1
			TALENT:MASTER:113 = 1
		P = RAND:16
		IF P <= 3 && (CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6)
			;天狗
			TALENT:81 = 1
		ELSEIF P <= 1 && CFLAG:MASTER:14 == 2
			;妖怪兎
			TALENT:MASTER:81 = 1
		ELSEIF P == 0
			TALENT:MASTER:81 = 1
		ENDIF
	ELSEIF O == 19
		;日光浴・月光浴
		IF CFLAG:MASTER:14 == 0
			;妖精
			P = RAND:4
			IF P == 0
				TALENT:MASTER:115 = 1
			ELSEIF P == 1
				TALENT:MASTER:116 = 1
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 1 || CFLAG:MASTER:14 == 3
			;人間、人形
			P = RAND:16
			IF P == 0
				TALENT:MASTER:115 = 1
			ELSEIF P == 1
				TALENT:MASTER:116 = 1
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 2 || CFLAG:MASTER:14 == 5 || CFLAG:MASTER:14 == 6
			;妖怪兎・天狗
			P = RAND:8
			IF P == 0
				TALENT:MASTER:115 = 1
			ELSEIF P == 1
				TALENT:MASTER:116 = 1
			ENDIF
		ELSEIF CFLAG:MASTER:14 == 4
			;魔界人
			P = RAND:6
			IF P == 0
				TALENT:MASTER:115 = 1
			ELSEIF P <= 3
				TALENT:MASTER:116 = 1
			ENDIF
		ENDIF
	ELSEIF O == 20
		;鼓舞
		P = RAND:4
		SIF P == 0
			TALENT:MASTER:118 = 1
	ELSEIF O == 21
		;幼稚・小悪魔
		P = RAND:4
		IF P == 0 && CFLAG:MASTER:14 == 0
			TALENT:MASTER:132 = 1
		ELSEIF P == 1
			TALENT:MASTER:87 = 1
		ENDIF
	ENDIF
REND
;能力
REPEAT 4
	O = COUNT
	IF O == 0
		;欲望
		P = RAND:3
		SIF P > 0
			ABL:MASTER:欲望 += RAND:2
	ELSEIF O == 1
		;技巧
		P = RAND:4
		SIF P > 0
			ABL:MASTER:技巧 += 1 + RAND:2
	ELSEIF O == 2
		;レズっ気
		P = RAND:16
		SIF P > 0
			ABL:MASTER:レズっ気 += RAND:3
	ELSEIF O == 3
		;レズ中毒
		P = RAND:3
		SIF P == 0 && ABL:MASTER:レズっ気
			ABL:MASTER:レズ中毒 += RAND:3
	ENDIF
REND
;経験
REPEAT 5
	O = COUNT
	
	IF O == 0 && TALENT:MASTER:0 == 0
		;Ｖ経験
		P = RAND:8
		SIF P > 0
			EXP:MASTER:0 += 1 + RAND:2
	ELSEIF O == 1
		;Ａ経験
		P = RAND:8
		SIF P > 0
			EXP:MASTER:1 += RAND:4
	ELSEIF O == 2
		;絶頂経験
		P = RAND:4
		SIF P > 0
			EXP:MASTER:2 += RAND:5
	ELSEIF O == 3
		;自慰経験
		P = RAND:4
		SIF P > 0
			EXP:MASTER:10 += RAND:7
	ELSEIF O == 4
		;異常経験
		P = RAND:4
		SIF P > 0
			EXP:MASTER:50 += RAND:2
	ENDIF
REND

;体力、気力が上昇していた場合、全快させる
SIF BASE:MASTER:0 != MAXBASE:MASTER:0
	BASE:MASTER:0 = MAXBASE:MASTER:0
SIF BASE:MASTER:1 != MAXBASE:MASTER:1
	BASE:MASTER:1 = MAXBASE:MASTER:1

RETURN 1
